# 麻醉守护神 (Anesthesia Guardian) - 系统功能详细文档

## 系统概览

麻醉守护神是一个综合性的围手术期智能决策支持系统，利用Google Gemini AI为医疗专业人员提供智能化的风险评估、药物相互作用分析和临床指导。

## 核心功能模块

### 1. 智能医疗记录识别 🔍
**功能描述：** 革命性的多模态AI医疗记录处理系统
- **图像上传：** 支持拍照或上传医疗记录图片
- **AI分析：** 使用Google Gemini 1.5 Flash模型进行图像分析
- **中文识别：** 专门优化的中文医疗信息提取提示词
- **信息提取：** 自动提取病史总结和用药信息
- **医生审核：** 提供可编辑的文本框供医生确认和修改

**技术实现：**
- 多模态图像分析（直接图像处理）
- OCR文字识别备用机制（Tesseract.js）
- 结构化JSON数据提取
- 实时处理状态显示

### 2. 患者信息管理 📋
**功能描述：** 完整的患者数据管理系统
- **患者登记：** 创建新患者档案
- **信息录入：** 手动输入或AI辅助录入患者信息
- **数据存储：** 安全的数据库存储和检索
- **历史查询：** 患者历史记录查看

**数据字段：**
- 基本信息：姓名、年龄、性别、联系方式
- 医疗信息：手术类型、既往病史、用药历史
- 生理指标：身高、体重、血压、心率等

### 3. 多智能体风险评估系统 🤖
**功能描述：** 协调多个专业AI代理进行综合评估
- **协调器代理：** 管理整个评估流程
- **病历提取代理：** 处理和分析医疗记录
- **风险评估代理：** 评估围手术期风险
- **药物分析代理：** 分析药物相互作用
- **指南咨询代理：** 搜索相关临床指南
- **质量检查代理：** 验证评估结果

**评估维度：**
- 气道管理风险（Mallampati评分、BMI、颈部活动度）
- 心血管风险（Goldman评分、合并症）
- 血栓风险（Caprini评分）
- 术后恶心呕吐风险（Apfel评分）
- 其他围手术期并发症

### 4. 智能药物相互作用分析 💊
**功能描述：** 全面的药物安全分析系统
- **药物数据库：** 218种核心药物的完整数据库
- **相互作用检测：** AI驱动的药物相互作用识别
- **严重程度分级：** 轻微、中度、重度相互作用分类
- **详细分析：** 点击查看深度药理学分析
- **临床建议：** 具体的监测和处理建议

**药物分类：**
- 心脏病药物（20种）
- 高血压药物（20种）
- 糖尿病药物（20种）
- 抗抑郁药物（20种）
- 帕金森病药物（20种）
- 肾病用药注意事项（20种）
- 完整麻醉药物（98种）

### 5. 术前停药指导 ⚠️
**功能描述：** 智能术前药物管理建议
- **停药建议：** 基于药物类型的个性化停药时间
- **风险评估：** 停药与继续用药的风险平衡
- **替代方案：** 围手术期药物替代建议
- **监测要点：** 术前术后监测重点

### 6. 临床指南智能检索 📚
**功能描述：** 循证医学指南搜索系统
- **智能搜索：** 基于患者条件和风险因素搜索
- **权威来源：** 来自权威医学组织的最新指南
- **相关性排序：** 高、中、低相关性智能分级
- **实用建议：** 具体的临床实践建议

### 7. AI医疗问答系统 💬
**功能描述：** 专业的医疗AI助手
- **实时对话：** 流畅的中文医疗对话
- **专业知识：** 麻醉学和围手术期专业知识
- **问题解答：** 临床问题的专业解答
- **学术支持：** 医学研究和学习支持

### 8. 实时监控面板 📊
**功能描述：** 直观的系统状态监控
- **代理状态：** 实时显示各AI代理工作状态
- **进度跟踪：** 评估进度的可视化显示
- **错误处理：** 智能错误恢复和重试机制
- **性能监控：** 系统性能和响应时间监控

## 技术架构

### 前端技术栈
- **框架：** React 18 + TypeScript
- **构建工具：** Vite（快速开发和优化构建）
- **样式：** Tailwind CSS + shadcn/ui组件库
- **状态管理：** TanStack Query（服务端状态管理）
- **路由：** Wouter（轻量级客户端路由）
- **表单处理：** React Hook Form + Zod验证

### 后端技术栈
- **运行环境：** Node.js + Express.js
- **语言：** TypeScript + ESM模块
- **数据库：** PostgreSQL（Neon serverless）
- **ORM：** Drizzle ORM（类型安全的数据库操作）
- **AI集成：** Google Gemini API（gemini-1.5-flash）
- **会话管理：** 内存会话存储

### 数据库设计
- **patients表：** 核心患者信息
- **assessments表：** 风险评估结果
- **agentLogs表：** AI代理活动日志
- **drugs表：** 药物信息数据库

## 安全特性

### 数据安全
- **敏感信息保护：** 患者隐私数据加密存储
- **访问控制：** 基于角色的访问权限
- **审计日志：** 完整的操作记录

### AI安全
- **输入验证：** 严格的输入数据验证
- **输出检查：** AI生成内容的安全检查
- **错误处理：** 优雅的错误恢复机制

## 性能优化

### 响应速度
- **并行处理：** 多AI代理并行工作
- **缓存策略：** 智能缓存减少重复计算
- **异步处理：** 非阻塞的异步操作

### 用户体验
- **实时反馈：** 即时的状态更新
- **渐进式加载：** 分步骤显示结果
- **错误恢复：** 自动重试和手动重置

## 部署环境

### 开发环境
- **热重载：** Vite HMR即时前端更新
- **数据库迁移：** Drizzle自动schema同步
- **错误处理：** 运行时错误覆盖和日志

### 生产环境
- **前端：** Vite构建和优化的静态资源
- **后端：** ESBuild打包的Express服务器
- **数据库：** PostgreSQL连接（DATABASE_URL）
- **AI服务：** Google Gemini API集成

## 环境变量配置

```bash
# 必需的环境变量
GEMINI_API_KEY=your_gemini_api_key_here
DATABASE_URL=your_database_url_here
NODE_ENV=development|production

# 自动生成的数据库变量
PGDATABASE=database_name
PGHOST=database_host
PGPASSWORD=database_password
PGPORT=database_port
PGUSER=database_user
```

## 使用流程

### 1. 患者登记流程
1. 访问"添加新患者"页面
2. 选择手动输入或拍照上传医疗记录
3. AI自动提取信息或手动填写
4. 医生审核和确认信息
5. 提交保存患者档案

### 2. 风险评估流程
1. 选择患者启动评估
2. 系统初始化多个AI代理
3. 并行分析各项风险因素
4. 生成综合风险评估报告
5. 提供具体的临床建议

### 3. 药物分析流程
1. 输入患者用药信息
2. AI分析药物相互作用
3. 显示风险级别和详细说明
4. 提供术前停药建议
5. 生成用药安全报告

## 系统优势

### 1. 智能化程度高
- 真正的多模态AI图像分析
- 专业的中文医疗信息处理
- 智能的风险评估和建议生成

### 2. 专业性强
- 基于权威医学指南和评分系统
- 专业的麻醉学知识库
- 循证医学的决策支持

### 3. 用户体验优秀
- 直观的可视化界面
- 实时的状态反馈
- 简单易用的操作流程

### 4. 技术先进性
- 最新的AI技术栈
- 现代化的前后端架构
- 高性能的数据库设计

## 更新日志

### 最新更新（2025年7月6日）
- ✅ 完成真正的多模态AI医疗记录分析系统
- ✅ 修复Google Gemini API集成问题
- ✅ 实现中文医疗信息提取
- ✅ 添加完整的错误处理机制
- ✅ 优化用户界面和体验

### 历史更新
- 2025年7月5日：交互式药物相互作用深度分析系统
- 2025年7月2日：核心药物数据库集成
- 2025年6月30日：AI问答功能
- 2025年6月29日：Gemini API迁移

---

*麻醉守护神 - 让围手术期更加安全智能*