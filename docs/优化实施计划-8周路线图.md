# AnesGuardian ä¼˜åŒ–å®æ–½è®¡åˆ’ - 8å‘¨è·¯çº¿å›¾

**åˆ¶å®šæ—¥æœŸï¼š** 2025-11-05
**é¡¹ç›®ç‰ˆæœ¬ï¼š** v2.1.0
**å®æ–½å‘¨æœŸï¼š** 8å‘¨ï¼ˆ56å¤©ï¼‰
**æ¯å‘¨æŠ•å…¥ï¼š** 10-15å°æ—¶ï¼ˆä¸ªäººå…¼èŒå¼€å‘ï¼‰
**ä¸Šçº¿ç›®æ ‡ï¼š** 1-2ä¸ªæœˆå†…ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## ğŸ“Š è®¡åˆ’æ¦‚è§ˆ

### æ ¸å¿ƒç­–ç•¥

é‡‡ç”¨**"æ ¸å¿ƒå¿…åš + å¿«é€Ÿèƒœåˆ© + æ¸è¿›ä¼˜åŒ–"**çš„ä¸‰å±‚ç­–ç•¥ï¼Œç¡®ä¿åœ¨æœ‰é™æ—¶é—´å†…å®Œæˆç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„æœ€å…³é”®ä¼˜åŒ–ã€‚

### ä¼˜åŒ–ä¼˜å…ˆçº§

æ ¹æ®ä½ çš„éœ€æ±‚ï¼ˆè¿‘æœŸä¸Šçº¿ç”Ÿäº§ï¼Œå…³æ³¨æ‰€æœ‰è´¨é‡æŒ‡æ ‡ï¼‰ï¼Œä¼˜åŒ–æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ’åˆ—ï¼š

1. ğŸ”´ **P0 - ç”Ÿäº§å¿…å¤‡**ï¼šå®‰å…¨åŠ å›ºã€é”™è¯¯å¤„ç†ã€åŸºç¡€ç›‘æ§
2. ğŸŸ  **P1 - è´¨é‡ä¿éšœ**ï¼šæ ¸å¿ƒæµ‹è¯•ã€æ—¥å¿—ç³»ç»Ÿ
3. ğŸŸ¡ **P2 - æ€§èƒ½æå‡**ï¼šå…³é”®æ€§èƒ½ä¼˜åŒ–ã€ç”Ÿäº§å‡†å¤‡

### æ—¶é—´çº¿æ€»è§ˆ

| å‘¨æ¬¡ | é˜¶æ®µ | æ ¸å¿ƒä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|--------|
| Week 1-2 | ğŸ”´ å®‰å…¨åŠ å›º | é€Ÿç‡é™åˆ¶ã€è¾“å…¥éªŒè¯ã€é”™è¯¯å¤„ç† | 15-20h | P0 |
| Week 3-4 | ğŸ“Š ç›‘æ§æ—¥å¿— | ç»“æ„åŒ–æ—¥å¿—ã€å¥åº·æ£€æŸ¥ã€åŸºç¡€ç›‘æ§ | 12-18h | P0 |
| Week 5-6 | ğŸ§ª æ ¸å¿ƒæµ‹è¯• | æµ‹è¯•æ¡†æ¶ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯• | 15-20h | P1 |
| Week 7-8 | âš¡ æ€§èƒ½+æ”¶å°¾ | æ€§èƒ½ä¼˜åŒ–ã€DockeråŒ–ã€ä¸Šçº¿å‡†å¤‡ | 15-20h | P1 |

**æ€»è®¡æ—¶é—´æŠ•å…¥ï¼š** 57-78å°æ—¶

---

## ğŸ”´ Week 1-2: å®‰å…¨åŠ å›ºï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰

**ç›®æ ‡ï¼š** æ»¡è¶³ç”Ÿäº§ç¯å¢ƒæœ€ä½å®‰å…¨è¦æ±‚ï¼Œé˜²æ­¢å¸¸è§å®‰å…¨å¨èƒ

**æ€»å·¥ä½œé‡ï¼š** 15-20å°æ—¶

---

### Week 1: åŸºç¡€å®‰å…¨é˜²æŠ¤ (15h)

#### ä»»åŠ¡1: æ·»åŠ é€Ÿç‡é™åˆ¶ (4h) - P0

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install express-rate-limit helmet express-validator
```

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/middleware/rate-limit.ts` - é€Ÿç‡é™åˆ¶é…ç½®
- `server/middleware/security.ts` - å®‰å…¨ä¸­é—´ä»¶é›†åˆ

**å®æ–½æ¸…å•ï¼š**
- [ ] é…ç½®å…¨å±€APIé€Ÿç‡é™åˆ¶ï¼ˆ100æ¬¡/15åˆ†é’Ÿï¼‰
- [ ] AIç«¯ç‚¹ç‰¹æ®Šé™åˆ¶ï¼ˆ10æ¬¡/åˆ†é’Ÿï¼‰
  - `/api/patients/:id/assess`
  - `/api/chat`
  - `/api/medical-reports/analyze`
- [ ] æ–‡ä»¶ä¸Šä¼ é™åˆ¶ï¼ˆ5æ¬¡/åˆ†é’Ÿï¼‰
  - `/api/medical-reports/upload`
- [ ] æ·»åŠ é€Ÿç‡é™åˆ¶é”™è¯¯æç¤ºï¼ˆä¸­æ–‡ï¼‰
- [ ] åœ¨`server/routes.ts`ä¸­åº”ç”¨ä¸­é—´ä»¶

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/middleware/rate-limit.ts
import rateLimit from 'express-rate-limit';

export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100,
  message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·15åˆ†é’Ÿåå†è¯•',
  standardHeaders: true,
  legacyHeaders: false,
});

export const aiLimiter = rateLimit({
  windowMs: 60 * 1000, // 1åˆ†é’Ÿ
  max: 10,
  message: 'AIæœåŠ¡è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
});

export const uploadLimiter = rateLimit({
  windowMs: 60 * 1000,
  max: 5,
  message: 'æ–‡ä»¶ä¸Šä¼ è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
});
```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… è¶…è¿‡é™åˆ¶æ—¶è¿”å›429çŠ¶æ€ç 
- âœ… é”™è¯¯ä¿¡æ¯æ¸…æ™°å‹å¥½
- âœ… ä¸å½±å“æ­£å¸¸ç”¨æˆ·ä½¿ç”¨

---

#### ä»»åŠ¡2: æ·»åŠ helmetä¸­é—´ä»¶ (2h) - P0

**å®æ–½æ¸…å•ï¼š**
- [ ] å®‰è£…å¹¶é…ç½®helmet
- [ ] é…ç½®CSPï¼ˆContent Security Policyï¼‰
- [ ] å¯ç”¨HSTSï¼ˆä»…ç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] é…ç½®å…¶ä»–å®‰å…¨headers

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/middleware/security.ts
import helmet from 'helmet';

export const securityHeaders = helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
  hsts: process.env.NODE_ENV === 'production' ? {
    maxAge: 31536000,
    includeSubDomains: true,
  } : false,
});
```

**åœ¨server/index.tsä¸­åº”ç”¨ï¼š**
```typescript
import { securityHeaders } from './middleware/security';
app.use(securityHeaders);
```

---

#### ä»»åŠ¡3: è¾“å…¥éªŒè¯å¢å¼º (5h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/utils/sanitize.ts` - è¾“å…¥æ¸…ç†å·¥å…·

**å®æ–½æ¸…å•ï¼š**
- [ ] åˆ›å»ºsanitizeå·¥å…·å‡½æ•°
- [ ] åœ¨æ‰€æœ‰POST/PATCHç«¯ç‚¹æ·»åŠ è¾“å…¥æ¸…ç†
- [ ] æ–‡ä»¶ä¸Šä¼ ç±»å‹ç™½åå•ï¼ˆä»…å…è®¸å›¾ç‰‡ï¼‰
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆæœ€å¤§10MBï¼‰
- [ ] SQLæ³¨å…¥é˜²æŠ¤éªŒè¯ï¼ˆDrizzleå·²æä¾›åŸºç¡€é˜²æŠ¤ï¼‰

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/sanitize.ts
export function sanitizeInput(input: any): any {
  if (typeof input === 'string') {
    // ç§»é™¤æ½œåœ¨çš„è„šæœ¬æ ‡ç­¾
    return input
      .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
      .trim();
  }

  if (Array.isArray(input)) {
    return input.map(sanitizeInput);
  }

  if (typeof input === 'object' && input !== null) {
    const sanitized: any = {};
    for (const key in input) {
      sanitized[key] = sanitizeInput(input[key]);
    }
    return sanitized;
  }

  return input;
}
```

**åœ¨routes.tsä¸­åº”ç”¨ï¼š**
```typescript
import { sanitizeInput } from './utils/sanitize';

app.post("/api/patients", async (req, res) => {
  const sanitized = sanitizeInput(req.body);
  const result = insertPatientSchema.safeParse(sanitized);
  // ...
});
```

**æ–‡ä»¶ä¸Šä¼ éªŒè¯ï¼š**
```typescript
const upload = multer({
  storage: multer.memoryStorage(),
  limits: {
    fileSize: 10 * 1024 * 1024, // 10MB
  },
  fileFilter: (req, file, cb) => {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg'];
    if (allowedTypes.includes(file.mimetype)) {
      cb(null, true);
    } else {
      cb(new Error('åªå…è®¸ä¸Šä¼ JPGã€PNGæ ¼å¼çš„å›¾ç‰‡'));
    }
  }
});
```

---

#### ä»»åŠ¡4: CORSé…ç½®å¼ºåŒ– (2h) - P0

**å®æ–½æ¸…å•ï¼š**
- [ ] é™åˆ¶å…è®¸çš„æºï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] é…ç½®credentialså’Œheaders
- [ ] æ·»åŠ é¢„æ£€è¯·æ±‚ä¼˜åŒ–

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/index.ts
import cors from 'cors';

const allowedOrigins = process.env.ALLOWED_ORIGINS?.split(',') || [
  'http://localhost:5173',
  'http://localhost:5000'
];

app.use(cors({
  origin: (origin, callback) => {
    // å…è®¸æ²¡æœ‰originçš„è¯·æ±‚ï¼ˆå¦‚ç§»åŠ¨åº”ç”¨ï¼‰
    if (!origin) return callback(null, true);

    if (allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
  optionsSuccessStatus: 200,
  methods: ['GET', 'POST', 'PATCH', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization'],
}));
```

**ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.envï¼‰ï¼š**
```env
# ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®
ALLOWED_ORIGINS=https://your-domain.com,https://www.your-domain.com
```

---

#### ä»»åŠ¡5: æ•æ„Ÿæ•°æ®å¤„ç† (2h) - P1

**å®æ–½æ¸…å•ï¼š**
- [ ] æ ‡è®°æ‚£è€…éšç§å­—æ®µ
- [ ] æ—¥å¿—ä¸­ç§»é™¤æ•æ„Ÿä¿¡æ¯
- [ ] ç¯å¢ƒå˜é‡å®‰å…¨æ£€æŸ¥

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/logger.ts (åç»­åˆ›å»º)
function sanitizeLogData(data: any): any {
  const sensitiveFields = ['password', 'token', 'apiKey', 'secret'];

  if (typeof data === 'object' && data !== null) {
    const sanitized = { ...data };
    for (const field of sensitiveFields) {
      if (field in sanitized) {
        sanitized[field] = '[REDACTED]';
      }
    }
    return sanitized;
  }

  return data;
}
```

---

### Week 2: é”™è¯¯å¤„ç†æ ‡å‡†åŒ– (10h)

#### ä»»åŠ¡6: ç»Ÿä¸€é”™è¯¯å¤„ç† (6h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/utils/errors.ts` - é”™è¯¯ç±»å®šä¹‰
- `server/middleware/error-handler.ts` - å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶

**å®æ–½æ¸…å•ï¼š**
- [ ] åˆ›å»ºAppErrorç±»å±‚æ¬¡ç»“æ„
- [ ] å®ç°å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- [ ] é‡æ„æ‰€æœ‰APIç«¯ç‚¹çš„é”™è¯¯å¤„ç†
- [ ] æ·»åŠ é”™è¯¯ä»£ç ä½“ç³»

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/errors.ts
export class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public code: string,
    public isOperational = true
  ) {
    super(message);
    Object.setPrototypeOf(this, AppError.prototype);
  }
}

export class ValidationError extends AppError {
  constructor(message: string) {
    super(400, message, 'VALIDATION_ERROR');
  }
}

export class NotFoundError extends AppError {
  constructor(resource: string) {
    super(404, `${resource}ä¸å­˜åœ¨`, 'NOT_FOUND');
  }
}

export class UnauthorizedError extends AppError {
  constructor(message = 'æœªæˆæƒè®¿é—®') {
    super(401, message, 'UNAUTHORIZED');
  }
}
```

```typescript
// server/middleware/error-handler.ts
import { Request, Response, NextFunction } from 'express';
import { AppError } from '../utils/errors';
import { logger } from '../utils/logger'; // å°†åœ¨Week 3åˆ›å»º

export const errorHandler = (
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  if (err instanceof AppError) {
    logger.warn('Operational error:', {
      code: err.code,
      message: err.message,
      statusCode: err.statusCode,
      path: req.path,
    });

    return res.status(err.statusCode).json({
      status: 'error',
      code: err.code,
      message: err.message,
    });
  }

  // æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', {
    error: err.message,
    stack: err.stack,
    path: req.path,
  });

  res.status(500).json({
    status: 'error',
    code: 'INTERNAL_ERROR',
    message: process.env.NODE_ENV === 'production'
      ? 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
      : err.message,
  });
};
```

**åœ¨routes.tsä¸­ä½¿ç”¨ï¼š**
```typescript
import { NotFoundError, ValidationError } from './utils/errors';

app.get("/api/patients/:id", async (req, res, next) => {
  try {
    const patientId = parseInt(req.params.id);
    const patient = await storage.getPatient(patientId);

    if (!patient) {
      throw new NotFoundError('æ‚£è€…');
    }

    res.json(patient);
  } catch (error) {
    next(error); // ä¼ é€’ç»™é”™è¯¯å¤„ç†ä¸­é—´ä»¶
  }
});
```

**åœ¨server/index.tsæœ€åæ·»åŠ ï¼š**
```typescript
import { errorHandler } from './middleware/error-handler';

// æ‰€æœ‰è·¯ç”±ä¹‹å
app.use(errorHandler);
```

---

#### ä»»åŠ¡7: ç”Ÿäº§ç¯å¢ƒé…ç½® (4h) - P0

**å®æ–½æ¸…å•ï¼š**
- [ ] å¢å¼ºç¯å¢ƒå˜é‡å®Œæ•´æ€§æ£€æŸ¥
- [ ] ç”Ÿäº§ç¯å¢ƒç‰¹æ®Šé…ç½®
- [ ] æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- [ ] Sessionå®‰å…¨é…ç½®

**ä»£ç æ”¹è¿›ï¼š**
```typescript
// server/index.ts - å¢å¼ºç°æœ‰çš„validateEnvironmentVariables
function validateEnvironmentVariables() {
  const requiredVars = {
    'GEMINI_API_KEY': 'Google Gemini AI API key is required',
    'DATABASE_URL': 'PostgreSQL database connection string is required'
  };

  // ç”Ÿäº§ç¯å¢ƒé¢å¤–è¦æ±‚
  if (process.env.NODE_ENV === 'production') {
    Object.assign(requiredVars, {
      'SESSION_SECRET': 'Session secret is required in production',
      'ALLOWED_ORIGINS': 'Allowed origins must be configured in production',
    });
  }

  // ... å…¶ä½™éªŒè¯é€»è¾‘
}
```

**æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼š**
```typescript
// server/db.ts
import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';

const connectionString = process.env.DATABASE_URL!;

const sql = neon(connectionString, {
  fetchConnectionCache: true,
  // ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± é…ç½®
  ...(process.env.NODE_ENV === 'production' && {
    fullResults: true,
  })
});

export const db = drizzle(sql);
```

---

### Week 1-2 äº¤ä»˜ç‰©

**ä»£ç äº¤ä»˜ï¼š**
- âœ… `server/middleware/rate-limit.ts` - é€Ÿç‡é™åˆ¶é…ç½®
- âœ… `server/middleware/security.ts` - å®‰å…¨ä¸­é—´ä»¶
- âœ… `server/middleware/error-handler.ts` - é”™è¯¯å¤„ç†
- âœ… `server/utils/errors.ts` - é”™è¯¯ç±»å®šä¹‰
- âœ… `server/utils/sanitize.ts` - è¾“å…¥æ¸…ç†å·¥å…·

**åŠŸèƒ½å®Œæˆï¼š**
- âœ… æ‰€æœ‰APIç«¯ç‚¹æœ‰é€Ÿç‡é™åˆ¶
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å®‰å…¨headerså…¨é¢é…ç½®
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®å®Œå–„
- âœ… è¾“å…¥éªŒè¯å’Œæ¸…ç†

**æ–‡æ¡£è¾“å‡ºï¼š**
- ğŸ“„ `docs/å®‰å…¨é…ç½®æ–‡æ¡£.md` - å®‰å…¨æªæ–½è¯´æ˜

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] è¶…å‡ºé€Ÿç‡é™åˆ¶æ—¶æ­£ç¡®è¿”å›429
- [ ] æ‰€æœ‰é”™è¯¯æœ‰ç»Ÿä¸€æ ¼å¼
- [ ] å®‰å…¨æ‰«ææ— é«˜å±æ¼æ´
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®æ£€æŸ¥é€šè¿‡

---

## ğŸ“Š Week 3-4: ç›‘æ§æ—¥å¿—ï¼ˆå¯è§‚æµ‹æ€§ï¼‰

**ç›®æ ‡ï¼š** å»ºç«‹ç”Ÿäº§ç¯å¢ƒé—®é¢˜å¿«é€Ÿå®šä½èƒ½åŠ›

**æ€»å·¥ä½œé‡ï¼š** 12-18å°æ—¶

---

### Week 3: ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ (12h)

#### ä»»åŠ¡8: Winstonæ—¥å¿—é›†æˆ (6h) - P0

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install winston winston-daily-rotate-file
```

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/utils/logger.ts` - Winstoné…ç½®
- `server/middleware/request-logger.ts` - è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶

**å®æ–½æ¸…å•ï¼š**
- [ ] é…ç½®Winston loggerï¼ˆæ–‡ä»¶+æ§åˆ¶å°ï¼‰
- [ ] æ—¥å¿—åˆ†çº§ï¼ˆerror/warn/info/debugï¼‰
- [ ] æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆæ¯æ—¥ï¼Œä¿ç•™14å¤©ï¼‰
- [ ] æ›¿æ¢æ‰€æœ‰console.log/error

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/logger.ts
import winston from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';

const logFormat = winston.format.combine(
  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
  winston.format.errors({ stack: true }),
  winston.format.json()
);

const transports: winston.transport[] = [
  // é”™è¯¯æ—¥å¿—
  new DailyRotateFile({
    filename: 'logs/error-%DATE%.log',
    datePattern: 'YYYY-MM-DD',
    level: 'error',
    maxFiles: '14d',
    maxSize: '20m',
  }),

  // ç»¼åˆæ—¥å¿—
  new DailyRotateFile({
    filename: 'logs/combined-%DATE%.log',
    datePattern: 'YYYY-MM-DD',
    maxFiles: '14d',
    maxSize: '20m',
  }),
];

// å¼€å‘ç¯å¢ƒæ·»åŠ æ§åˆ¶å°è¾“å‡º
if (process.env.NODE_ENV !== 'production') {
  transports.push(
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      ),
    })
  );
}

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: logFormat,
  transports,
});

// ä¾¿æ·æ–¹æ³•
export const log = {
  error: (message: string, meta?: any) => logger.error(message, meta),
  warn: (message: string, meta?: any) => logger.warn(message, meta),
  info: (message: string, meta?: any) => logger.info(message, meta),
  debug: (message: string, meta?: any) => logger.debug(message, meta),
};
```

**æ›¿æ¢ç°æœ‰console.logï¼š**
```typescript
// æŸ¥æ‰¾å¹¶æ›¿æ¢æ‰€æœ‰çš„console.log
// æ—§ä»£ç ï¼š
console.log("æ¥æ”¶åˆ°æ‚£è€…æ•°æ®:", data);

// æ–°ä»£ç ï¼š
logger.info('æ¥æ”¶åˆ°æ‚£è€…æ•°æ®', { data });
```

**åˆ›å»ºlogsç›®å½•ï¼š**
```bash
mkdir -p logs
echo "logs/" >> .gitignore
```

---

#### ä»»åŠ¡9: è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ (3h) - P0

**å®æ–½æ¸…å•ï¼š**
- [ ] è®°å½•æ‰€æœ‰APIè¯·æ±‚
- [ ] è®°å½•å“åº”æ—¶é—´
- [ ] è®°å½•AIæœåŠ¡è°ƒç”¨
- [ ] ç”¨æˆ·æ“ä½œå®¡è®¡æ—¥å¿—

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/middleware/request-logger.ts
import { Request, Response, NextFunction } from 'express';
import { logger } from '../utils/logger';

export const requestLogger = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();

  // å“åº”ç»“æŸæ—¶è®°å½•
  res.on('finish', () => {
    const duration = Date.now() - start;

    logger.info('API Request', {
      method: req.method,
      path: req.path,
      statusCode: res.statusCode,
      duration: `${duration}ms`,
      ip: req.ip,
      userAgent: req.get('user-agent'),
    });

    // æ…¢è¯·æ±‚è­¦å‘Š
    if (duration > 5000) {
      logger.warn('Slow API Request', {
        method: req.method,
        path: req.path,
        duration: `${duration}ms`,
      });
    }
  });

  next();
};
```

**åœ¨server/index.tsä¸­åº”ç”¨ï¼š**
```typescript
import { requestLogger } from './middleware/request-logger';

app.use(express.json());
app.use(requestLogger); // åœ¨è·¯ç”±ä¹‹å‰
```

---

#### ä»»åŠ¡10: é”™è¯¯æ—¥å¿—å¢å¼º (3h) - P1

**å®æ–½æ¸…å•ï¼š**
- [ ] å †æ ˆè¿½è¸ªè®°å½•
- [ ] é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯
- [ ] ç”¨æˆ·IDå’Œè¯·æ±‚IDå…³è”
- [ ] AIæœåŠ¡é”™è¯¯ä¸“é¡¹è®°å½•

**åœ¨error-handler.tsä¸­å¢å¼ºï¼š**
```typescript
export const errorHandler = (
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const errorContext = {
    error: err.message,
    stack: err.stack,
    path: req.path,
    method: req.method,
    body: req.body,
    params: req.params,
    query: req.query,
    ip: req.ip,
    timestamp: new Date().toISOString(),
  };

  if (err instanceof AppError) {
    logger.warn('Operational error', errorContext);
  } else {
    logger.error('Unexpected error', errorContext);
  }

  // ... å…¶ä½™å“åº”é€»è¾‘
};
```

**AIæœåŠ¡è°ƒç”¨æ—¥å¿—ï¼š**
```typescript
// server/services/gemini.ts - åœ¨AIè°ƒç”¨å¤„æ·»åŠ 
logger.info('Gemini APIè°ƒç”¨', {
  model: 'gemini-1.5-flash',
  promptLength: prompt.length,
  timestamp: new Date().toISOString(),
});

try {
  const result = await model.generateContent(prompt);
  logger.info('Gemini APIå“åº”æˆåŠŸ', {
    responseLength: result.response.text().length,
    duration: `${Date.now() - start}ms`,
  });
} catch (error) {
  logger.error('Gemini APIè°ƒç”¨å¤±è´¥', {
    error: error.message,
    model: 'gemini-1.5-flash',
  });
  throw error;
}
```

---

### Week 4: å¥åº·æ£€æŸ¥å’Œç›‘æ§ (10h)

#### ä»»åŠ¡11: å¥åº·æ£€æŸ¥ç«¯ç‚¹ (4h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/health.ts` - å¥åº·æ£€æŸ¥é€»è¾‘

**å®æ–½æ¸…å•ï¼š**
- [ ] `/health` åŸºç¡€å¥åº·æ£€æŸ¥
- [ ] `/health/detailed` è¯¦ç»†çŠ¶æ€
- [ ] æ•°æ®åº“è¿æ¥æ£€æŸ¥
- [ ] Gemini APIè¿æ¥æ£€æŸ¥
- [ ] ç£ç›˜ç©ºé—´æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/health.ts
import { Request, Response } from 'express';
import { db } from './db';
import { sql } from 'drizzle-orm';
import { GoogleGenerativeAI } from '@google/generative-ai';

// åŸºç¡€å¥åº·æ£€æŸ¥
export async function healthCheck(req: Request, res: Response) {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
  });
}

// è¯¦ç»†å¥åº·æ£€æŸ¥
export async function detailedHealthCheck(req: Request, res: Response) {
  const health: any = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    services: {},
  };

  // æ£€æŸ¥æ•°æ®åº“
  try {
    await db.execute(sql`SELECT 1`);
    health.services.database = {
      status: 'healthy',
      type: 'PostgreSQL',
    };
  } catch (error) {
    health.services.database = {
      status: 'unhealthy',
      error: error.message,
    };
    health.status = 'degraded';
  }

  // æ£€æŸ¥Gemini API
  try {
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');
    const model = genAI.getGenerativeModel({ model: 'gemini-2.0-flash-lite' });
    await model.generateContent('test');

    health.services.geminiAPI = {
      status: 'healthy',
    };
  } catch (error) {
    health.services.geminiAPI = {
      status: 'unhealthy',
      error: error.message,
    };
    health.status = 'degraded';
  }

  // å†…å­˜ä½¿ç”¨
  const memUsage = process.memoryUsage();
  health.memory = {
    heapUsed: `${Math.round(memUsage.heapUsed / 1024 / 1024)}MB`,
    heapTotal: `${Math.round(memUsage.heapTotal / 1024 / 1024)}MB`,
  };

  const statusCode = health.status === 'healthy' ? 200 : 503;
  res.status(statusCode).json(health);
}
```

**åœ¨routes.tsä¸­æ·»åŠ ï¼š**
```typescript
import { healthCheck, detailedHealthCheck } from './health';

// å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰
app.get('/health', healthCheck);
app.get('/health/detailed', detailedHealthCheck);
```

---

#### ä»»åŠ¡12: åŸºç¡€ç›‘æ§æŒ‡æ ‡ (3h) - P1

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/utils/metrics.ts` - ç›‘æ§æŒ‡æ ‡æ”¶é›†

**å®æ–½æ¸…å•ï¼š**
- [ ] APIå“åº”æ—¶é—´ç»Ÿè®¡
- [ ] é”™è¯¯ç‡ç»Ÿè®¡
- [ ] AIè°ƒç”¨æˆåŠŸç‡
- [ ] å†…å­˜å’ŒCPUä½¿ç”¨ç‡

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/metrics.ts
class Metrics {
  private apiCalls: Map<string, number> = new Map();
  private apiErrors: Map<string, number> = new Map();
  private apiResponseTimes: Map<string, number[]> = new Map();
  private aiCalls = { success: 0, failure: 0 };

  recordAPICall(path: string, duration: number, success: boolean) {
    // è®°å½•è°ƒç”¨æ¬¡æ•°
    const calls = this.apiCalls.get(path) || 0;
    this.apiCalls.set(path, calls + 1);

    // è®°å½•é”™è¯¯
    if (!success) {
      const errors = this.apiErrors.get(path) || 0;
      this.apiErrors.set(path, errors + 1);
    }

    // è®°å½•å“åº”æ—¶é—´
    const times = this.apiResponseTimes.get(path) || [];
    times.push(duration);
    if (times.length > 100) times.shift(); // ä¿ç•™æœ€è¿‘100æ¬¡
    this.apiResponseTimes.set(path, times);
  }

  recordAICall(success: boolean) {
    if (success) {
      this.aiCalls.success++;
    } else {
      this.aiCalls.failure++;
    }
  }

  getStats() {
    const stats: any = {
      api: {},
      ai: this.aiCalls,
      system: {
        memory: process.memoryUsage(),
        uptime: process.uptime(),
      }
    };

    // APIç»Ÿè®¡
    for (const [path, calls] of this.apiCalls.entries()) {
      const errors = this.apiErrors.get(path) || 0;
      const times = this.apiResponseTimes.get(path) || [];
      const avgTime = times.reduce((a, b) => a + b, 0) / times.length;

      stats.api[path] = {
        calls,
        errors,
        errorRate: `${((errors / calls) * 100).toFixed(2)}%`,
        avgResponseTime: `${Math.round(avgTime)}ms`,
      };
    }

    return stats;
  }

  reset() {
    this.apiCalls.clear();
    this.apiErrors.clear();
    this.apiResponseTimes.clear();
    this.aiCalls = { success: 0, failure: 0 };
  }
}

export const metrics = new Metrics();
```

**åœ¨request-logger.tsä¸­é›†æˆï¼š**
```typescript
res.on('finish', () => {
  const duration = Date.now() - start;
  const success = res.statusCode < 400;

  metrics.recordAPICall(req.path, duration, success);

  // ... å…¶ä½™æ—¥å¿—é€»è¾‘
});
```

**æ·»åŠ æŒ‡æ ‡æŸ¥çœ‹ç«¯ç‚¹ï¼š**
```typescript
// server/routes.ts
import { metrics } from './utils/metrics';

app.get('/metrics', (req, res) => {
  res.json(metrics.getStats());
});
```

---

#### ä»»åŠ¡13: å‘Šè­¦æœºåˆ¶ï¼ˆç®€å•ç‰ˆï¼‰(3h) - P2

**å®æ–½æ¸…å•ï¼š**
- [ ] é”™è¯¯ç‡è¶…é˜ˆå€¼å‘Šè­¦
- [ ] æ•°æ®åº“è¿æ¥å¤±è´¥å‘Šè­¦
- [ ] AIæœåŠ¡å¤±è´¥å‘Šè­¦
- [ ] Webhookæˆ–é‚®ä»¶é€šçŸ¥

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/utils/alerts.ts
import { logger } from './logger';

interface AlertConfig {
  webhookUrl?: string;
  errorThreshold: number; // é”™è¯¯ç‡é˜ˆå€¼ (%)
  checkInterval: number; // æ£€æŸ¥é—´éš” (ms)
}

class AlertManager {
  private config: AlertConfig;
  private lastAlertTime: Map<string, number> = new Map();
  private alertCooldown = 5 * 60 * 1000; // 5åˆ†é’Ÿå†…åŒä¸€å‘Šè­¦åªå‘é€ä¸€æ¬¡

  constructor(config: AlertConfig) {
    this.config = config;
  }

  async sendAlert(type: string, message: string, data?: any) {
    // æ£€æŸ¥å†·å´æ—¶é—´
    const lastTime = this.lastAlertTime.get(type) || 0;
    if (Date.now() - lastTime < this.alertCooldown) {
      return; // åœ¨å†·å´æœŸå†…ï¼Œä¸é‡å¤å‘é€
    }

    logger.error(`ALERT: ${type}`, { message, data });

    // å‘é€åˆ°Webhookï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    if (this.config.webhookUrl) {
      try {
        await fetch(this.config.webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type,
            message,
            data,
            timestamp: new Date().toISOString(),
          }),
        });
      } catch (error) {
        logger.error('Failed to send alert', { error: error.message });
      }
    }

    this.lastAlertTime.set(type, Date.now());
  }

  checkErrorRate(stats: any) {
    for (const [path, data] of Object.entries(stats.api)) {
      const errorRate = parseFloat((data as any).errorRate);
      if (errorRate > this.config.errorThreshold) {
        this.sendAlert('HIGH_ERROR_RATE', `${path} é”™è¯¯ç‡è¿‡é«˜`, {
          path,
          errorRate: `${errorRate}%`,
        });
      }
    }
  }
}

export const alertManager = new AlertManager({
  webhookUrl: process.env.ALERT_WEBHOOK_URL,
  errorThreshold: 10, // 10%
  checkInterval: 60000, // 1åˆ†é’Ÿ
});
```

**ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰ï¼š**
```env
# å‘Šè­¦Webhook URLï¼ˆå¯é€‰ï¼Œå¦‚Slack/é’‰é’‰/ä¼ä¸šå¾®ä¿¡ï¼‰
ALERT_WEBHOOK_URL=https://your-webhook-url
```

---

### Week 3-4 äº¤ä»˜ç‰©

**ä»£ç äº¤ä»˜ï¼š**
- âœ… `server/utils/logger.ts` - Winstonæ—¥å¿—é…ç½®
- âœ… `server/middleware/request-logger.ts` - è¯·æ±‚æ—¥å¿—
- âœ… `server/health.ts` - å¥åº·æ£€æŸ¥
- âœ… `server/utils/metrics.ts` - ç›‘æ§æŒ‡æ ‡
- âœ… `server/utils/alerts.ts` - å‘Šè­¦ç³»ç»Ÿ

**åŠŸèƒ½å®Œæˆï¼š**
- âœ… å®Œæ•´çš„ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ
- âœ… æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨è½®è½¬
- âœ… å¥åº·æ£€æŸ¥API
- âœ… åŸºç¡€ç›‘æ§æŒ‡æ ‡
- âœ… ç®€å•å‘Šè­¦æœºåˆ¶

**æ–‡æ¡£è¾“å‡ºï¼š**
- ğŸ“„ `docs/æ—¥å¿—æŸ¥è¯¢å’Œåˆ†ææŒ‡å—.md`
- ğŸ“„ `docs/ç›‘æ§æŒ‡æ ‡è¯´æ˜.md`

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] logs/ç›®å½•æœ‰æ¯æ—¥æ—¥å¿—æ–‡ä»¶
- [ ] `/health/detailed` è¿”å›æ‰€æœ‰æœåŠ¡çŠ¶æ€
- [ ] `/metrics` æ˜¾ç¤ºå®Œæ•´ç»Ÿè®¡
- [ ] é«˜é”™è¯¯ç‡æ—¶æœ‰å‘Šè­¦è®°å½•

---

## ğŸ§ª Week 5-6: æ ¸å¿ƒæµ‹è¯•ï¼ˆè´¨é‡ä¿éšœï¼‰

**ç›®æ ‡ï¼š** ç¡®ä¿å…³é”®åŠŸèƒ½ç¨³å®šæ€§ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°30%

**æ€»å·¥ä½œé‡ï¼š** 15-20å°æ—¶

---

### Week 5: æµ‹è¯•æ¡†æ¶å’Œå•å…ƒæµ‹è¯• (18h)

#### ä»»åŠ¡14: æµ‹è¯•ç¯å¢ƒæ­å»º (4h) - P0

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom
npm install -D @testing-library/user-event @vitest/ui happy-dom
```

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `vitest.config.ts` - Vitesté…ç½®
- `server/test-utils.ts` - åç«¯æµ‹è¯•å·¥å…·
- `client/src/test-utils.tsx` - å‰ç«¯æµ‹è¯•å·¥å…·

**å®æ–½æ¸…å•ï¼š**
- [ ] é…ç½®Vitest
- [ ] é…ç½®æµ‹è¯•æ•°æ®åº“ï¼ˆä½¿ç”¨MemStorageï¼‰
- [ ] åˆ›å»ºæµ‹è¯•å·¥å…·å‡½æ•°
- [ ] Mock AIæœåŠ¡

**ä»£ç å‚è€ƒï¼š**
```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'happy-dom',
    setupFiles: ['./vitest.setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'dist/',
        '**/*.test.ts',
        '**/*.test.tsx',
      ],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './client/src'),
      '@shared': path.resolve(__dirname, './shared'),
    },
  },
});
```

```typescript
// vitest.setup.ts
import '@testing-library/jest-dom';
import { beforeAll, afterEach, afterAll } from 'vitest';

beforeAll(() => {
  // æµ‹è¯•ç¯å¢ƒè®¾ç½®
  process.env.NODE_ENV = 'test';
  process.env.DATABASE_URL = 'test'; // ä½¿ç”¨MemStorage
});

afterEach(() => {
  // æ¸…ç†
});
```

```typescript
// server/test-utils.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { MemStorage } from './storage';
import type { InsertPatient } from '@shared/schema';

export function createTestStorage() {
  return new MemStorage();
}

export function createMockPatient(): InsertPatient {
  return {
    name: 'æµ‹è¯•æ‚£è€…',
    age: 45,
    gender: 'ç”·',
    surgeryType: 'è…¹è…”é•œèƒ†å›Šåˆ‡é™¤æœ¯',
    asaClass: 'II',
    medicalHistory: ['é«˜è¡€å‹', 'ç³–å°¿ç—…'],
    medications: ['é˜¿å¸åŒ¹æ—', 'äºŒç”²åŒèƒ'],
    allergies: ['é’éœ‰ç´ '],
    vitalSigns: { bp: '140/90', hr: 80 },
    labResults: { glucose: 7.2 },
  };
}

export function mockGeminiAPI() {
  return {
    generateContent: vi.fn().mockResolvedValue({
      response: {
        text: () => 'æ¨¡æ‹Ÿçš„AIå“åº”',
      },
    }),
  };
}
```

**package.jsonæ·»åŠ è„šæœ¬ï¼š**
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

---

#### ä»»åŠ¡15: Schemaå’ŒéªŒè¯æµ‹è¯• (6h) - P1

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `shared/__tests__/schema.test.ts`

**å®æ–½æ¸…å•ï¼ˆ15ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰ï¼š**
- [ ] Patient schemaéªŒè¯æµ‹è¯•ï¼ˆ5ä¸ªï¼‰
- [ ] Assessment schemaæµ‹è¯•ï¼ˆ3ä¸ªï¼‰
- [ ] Drug schemaæµ‹è¯•ï¼ˆ3ä¸ªï¼‰
- [ ] Medical report schemaæµ‹è¯•ï¼ˆ4ä¸ªï¼‰

**ä»£ç å‚è€ƒï¼š**
```typescript
// shared/__tests__/schema.test.ts
import { describe, it, expect } from 'vitest';
import { insertPatientSchema, insertAssessmentSchema } from '../schema';

describe('Patient Schema Validation', () => {
  it('åº”è¯¥æ¥å—æœ‰æ•ˆçš„æ‚£è€…æ•°æ®', () => {
    const validPatient = {
      name: 'å¼ ä¸‰',
      age: 45,
      gender: 'ç”·',
      asaClass: 'II',
      medicalHistory: ['é«˜è¡€å‹'],
      medications: ['é˜¿å¸åŒ¹æ—'],
      allergies: [],
      vitalSigns: {},
      labResults: {},
    };

    const result = insertPatientSchema.safeParse(validPatient);
    expect(result.success).toBe(true);
  });

  it('åº”è¯¥æ‹’ç»ç¼ºå°‘å¿…éœ€å­—æ®µçš„æ•°æ®', () => {
    const invalidPatient = {
      name: 'å¼ ä¸‰',
      age: 45,
      // ç¼ºå°‘ gender å’Œ asaClass
    };

    const result = insertPatientSchema.safeParse(invalidPatient);
    expect(result.success).toBe(false);
  });

  it('åº”è¯¥æ¥å—ç©ºçš„medicationsæ•°ç»„', () => {
    const patient = {
      name: 'æå››',
      age: 30,
      gender: 'å¥³',
      asaClass: 'I',
      medications: [],
      allergies: [],
      medicalHistory: [],
      vitalSigns: {},
      labResults: {},
    };

    const result = insertPatientSchema.safeParse(patient);
    expect(result.success).toBe(true);
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†é»˜è®¤çš„surgeryType', () => {
    const patient = {
      name: 'ç‹äº”',
      age: 50,
      gender: 'ç”·',
      asaClass: 'III',
      medications: [],
      allergies: [],
      medicalHistory: [],
      vitalSigns: {},
      labResults: {},
    };

    const result = insertPatientSchema.safeParse(patient);
    expect(result.success).toBe(true);
    if (result.success) {
      expect(result.data.surgeryType).toBe('');
    }
  });

  it('åº”è¯¥éªŒè¯JSONå­—æ®µçš„ç±»å‹', () => {
    const invalidPatient = {
      name: 'èµµå…­',
      age: 35,
      gender: 'å¥³',
      asaClass: 'I',
      medications: 'not an array', // é”™è¯¯ç±»å‹
      allergies: [],
      medicalHistory: [],
      vitalSigns: {},
      labResults: {},
    };

    const result = insertPatientSchema.safeParse(invalidPatient);
    expect(result.success).toBe(false);
  });
});

describe('Assessment Schema Validation', () => {
  it('åº”è¯¥æ¥å—æœ‰æ•ˆçš„è¯„ä¼°æ•°æ®', () => {
    const validAssessment = {
      patientId: 1,
      status: 'pending',
      overallRisk: 'low',
      riskFactors: [],
      drugInteractions: [],
      clinicalGuidelines: [],
      recommendations: [],
      agentStatus: {},
    };

    const result = insertAssessmentSchema.safeParse(validAssessment);
    expect(result.success).toBe(true);
  });

  // ... æ›´å¤šæµ‹è¯•
});
```

---

#### ä»»åŠ¡16: é£é™©è¯„ä¼°é€»è¾‘æµ‹è¯• (8h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/services/__tests__/simple-agents.test.ts`
- `server/services/__tests__/drug-service.test.ts`

**å®æ–½æ¸…å•ï¼ˆ20ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰ï¼š**
- [ ] é£é™©å› ç´ ç”Ÿæˆæµ‹è¯•ï¼ˆ8ä¸ªï¼‰
- [ ] è¯ç‰©ç›¸äº’ä½œç”¨æ£€æµ‹ï¼ˆ6ä¸ªï¼‰
- [ ] è¯„åˆ†è®¡ç®—æµ‹è¯•ï¼ˆ6ä¸ªï¼‰

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/services/__tests__/simple-agents.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { SimpleAgentOrchestrator } from '../simple-agents';
import { createTestStorage, createMockPatient } from '../../test-utils';

describe('SimpleAgentOrchestrator', () => {
  let storage: ReturnType<typeof createTestStorage>;

  beforeEach(() => {
    storage = createTestStorage();
  });

  describe('é£é™©å› ç´ ç”Ÿæˆ', () => {
    it('åº”è¯¥è¯†åˆ«é«˜è¡€å‹ä½œä¸ºå¿ƒè¡€ç®¡é£é™©å› ç´ ', async () => {
      const patient = await storage.createPatient({
        ...createMockPatient(),
        medicalHistory: ['é«˜è¡€å‹'],
        age: 65,
      });

      const assessment = await storage.createAssessment({
        patientId: patient.id,
        status: 'pending',
        overallRisk: 'low',
        riskFactors: [],
        drugInteractions: [],
        clinicalGuidelines: [],
        recommendations: [],
        agentStatus: {},
      });

      const orchestrator = new SimpleAgentOrchestrator(assessment.id);
      const result = await orchestrator.runAssessment(patient.id);

      expect(result.riskFactors).toContainEqual(
        expect.objectContaining({
          type: 'cardiovascular',
          description: expect.stringContaining('é«˜è¡€å‹'),
        })
      );
    });

    it('åº”è¯¥åŸºäºå¹´é¾„å’ŒBMIè¯„ä¼°æ°”é“é£é™©', async () => {
      const patient = await storage.createPatient({
        ...createMockPatient(),
        age: 70,
        vitalSigns: { weight: 95, height: 165 }, // BMI > 30
      });

      const assessment = await storage.createAssessment({
        patientId: patient.id,
        status: 'pending',
        overallRisk: 'low',
        riskFactors: [],
        drugInteractions: [],
        clinicalGuidelines: [],
        recommendations: [],
        agentStatus: {},
      });

      const orchestrator = new SimpleAgentOrchestrator(assessment.id);
      const result = await orchestrator.runAssessment(patient.id);

      expect(result.riskFactors).toContainEqual(
        expect.objectContaining({
          type: 'airway',
          level: expect.stringMatching(/medium|high/),
        })
      );
    });

    it('åº”è¯¥è¯†åˆ«æŠ—å‡è¯ç‰©å¹¶è¯„ä¼°å‡ºè¡€é£é™©', async () => {
      const patient = await storage.createPatient({
        ...createMockPatient(),
        medications: ['åæ³•æ—', 'é˜¿å¸åŒ¹æ—'],
      });

      const assessment = await storage.createAssessment({
        patientId: patient.id,
        status: 'pending',
        overallRisk: 'low',
        riskFactors: [],
        drugInteractions: [],
        clinicalGuidelines: [],
        recommendations: [],
        agentStatus: {},
      });

      const orchestrator = new SimpleAgentOrchestrator(assessment.id);
      const result = await orchestrator.runAssessment(patient.id);

      expect(result.riskFactors).toContainEqual(
        expect.objectContaining({
          type: 'bleeding',
          level: 'high',
        })
      );
    });

    // ... æ›´å¤šé£é™©å› ç´ æµ‹è¯•
  });

  describe('è¯ç‰©ç›¸äº’ä½œç”¨æ£€æµ‹', () => {
    it('åº”è¯¥æ£€æµ‹åˆ°é˜¿å¸åŒ¹æ—å’Œåæ³•æ—çš„ç›¸äº’ä½œç”¨', async () => {
      const patient = await storage.createPatient({
        ...createMockPatient(),
        medications: ['é˜¿å¸åŒ¹æ—', 'åæ³•æ—'],
      });

      const assessment = await storage.createAssessment({
        patientId: patient.id,
        status: 'pending',
        overallRisk: 'low',
        riskFactors: [],
        drugInteractions: [],
        clinicalGuidelines: [],
        recommendations: [],
        agentStatus: {},
      });

      const orchestrator = new SimpleAgentOrchestrator(assessment.id);
      const result = await orchestrator.runAssessment(patient.id);

      expect(result.drugInteractions.length).toBeGreaterThan(0);
      expect(result.drugInteractions).toContainEqual(
        expect.objectContaining({
          drugs: expect.arrayContaining(['é˜¿å¸åŒ¹æ—', 'åæ³•æ—']),
          severity: 'major',
        })
      );
    });

    // ... æ›´å¤šè¯ç‰©ç›¸äº’ä½œç”¨æµ‹è¯•
  });
});
```

---

### Week 6: é›†æˆæµ‹è¯•å’ŒE2Eæµ‹è¯• (15h)

#### ä»»åŠ¡17: APIé›†æˆæµ‹è¯• (8h) - P1

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D supertest @types/supertest
```

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `server/__tests__/api.test.ts`

**å®æ–½æ¸…å•ï¼ˆ15ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰ï¼š**
- [ ] æ‚£è€…CRUDæ“ä½œï¼ˆ5ä¸ªï¼‰
- [ ] è¯„ä¼°æµç¨‹æµ‹è¯•ï¼ˆ5ä¸ªï¼‰
- [ ] è¯ç‰©åˆ†ææµ‹è¯•ï¼ˆ3ä¸ªï¼‰
- [ ] æ–‡ä»¶ä¸Šä¼ æµ‹è¯•ï¼ˆ2ä¸ªï¼‰

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/__tests__/api.test.ts
import { describe, it, expect, beforeAll, afterAll } from 'vitest';
import request from 'supertest';
import express from 'express';
import { registerRoutes } from '../routes';

describe('API Integration Tests', () => {
  let app: express.Application;
  let server: any;

  beforeAll(async () => {
    app = express();
    app.use(express.json());
    server = await registerRoutes(app);
  });

  afterAll(() => {
    if (server) server.close();
  });

  describe('æ‚£è€…ç®¡ç†API', () => {
    it('GET /api/patients åº”è¯¥è¿”å›æ‰€æœ‰æ‚£è€…', async () => {
      const response = await request(app)
        .get('/api/patients')
        .expect(200);

      expect(Array.isArray(response.body)).toBe(true);
    });

    it('POST /api/patients åº”è¯¥åˆ›å»ºæ–°æ‚£è€…', async () => {
      const newPatient = {
        name: 'æµ‹è¯•æ‚£è€…',
        age: 45,
        gender: 'ç”·',
        asaClass: 'II',
        medications: ['é˜¿å¸åŒ¹æ—'],
        allergies: [],
        medicalHistory: ['é«˜è¡€å‹'],
        vitalSigns: {},
        labResults: {},
      };

      const response = await request(app)
        .post('/api/patients')
        .send(newPatient)
        .expect(201);

      expect(response.body).toMatchObject({
        name: 'æµ‹è¯•æ‚£è€…',
        age: 45,
        gender: 'ç”·',
      });
      expect(response.body.id).toBeDefined();
    });

    it('POST /api/patients åº”è¯¥æ‹’ç»æ— æ•ˆæ•°æ®', async () => {
      const invalidPatient = {
        name: 'æµ‹è¯•',
        // ç¼ºå°‘å¿…éœ€å­—æ®µ
      };

      await request(app)
        .post('/api/patients')
        .send(invalidPatient)
        .expect(400);
    });

    // ... æ›´å¤šæµ‹è¯•
  });

  describe('è¯„ä¼°API', () => {
    let patientId: number;

    beforeEach(async () => {
      const response = await request(app)
        .post('/api/patients')
        .send({
          name: 'è¯„ä¼°æµ‹è¯•æ‚£è€…',
          age: 50,
          gender: 'å¥³',
          asaClass: 'II',
          medications: [],
          allergies: [],
          medicalHistory: [],
          vitalSigns: {},
          labResults: {},
        });

      patientId = response.body.id;
    });

    it('POST /api/patients/:id/assess åº”è¯¥å¯åŠ¨è¯„ä¼°', async () => {
      const response = await request(app)
        .post(`/api/patients/${patientId}/assess`)
        .expect(200);

      expect(response.body).toHaveProperty('assessmentId');
      expect(response.body.message).toContain('æˆåŠŸ');
    });

    it('GET /api/patients/:id/assessment åº”è¯¥è¿”å›è¯„ä¼°ç»“æœ', async () => {
      // å…ˆå¯åŠ¨è¯„ä¼°
      const assessResponse = await request(app)
        .post(`/api/patients/${patientId}/assess`);

      // ç­‰å¾…ä¸€å°æ®µæ—¶é—´
      await new Promise(resolve => setTimeout(resolve, 1000));

      // è·å–è¯„ä¼°ç»“æœ
      const response = await request(app)
        .get(`/api/patients/${patientId}/assessment`)
        .expect(200);

      expect(response.body).toHaveProperty('status');
      expect(response.body).toHaveProperty('agentStatus');
    });

    // ... æ›´å¤šæµ‹è¯•
  });
});
```

---

#### ä»»åŠ¡18: å…³é”®E2Eæµ‹è¯• (7h) - P1

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D playwright @playwright/test
npx playwright install
```

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `e2e/patient-flow.spec.ts`
- `e2e/assessment-flow.spec.ts`
- `playwright.config.ts`

**å®æ–½æ¸…å•ï¼ˆ3ä¸ªå…³é”®æµç¨‹ï¼‰ï¼š**
- [ ] æ‚£è€…åˆ›å»ºâ†’è¯„ä¼°â†’æŠ¥å‘Šæµç¨‹
- [ ] è¯ç‰©ç›¸äº’ä½œç”¨æŸ¥è¯¢æµç¨‹
- [ ] AIé—®ç­”æµç¨‹

**ä»£ç å‚è€ƒï¼š**
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  timeout: 30 * 1000,
  fullyParallel: true,
  retries: process.env.CI ? 2 : 0,
  use: {
    baseURL: 'http://localhost:5000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:5000',
    reuseExistingServer: !process.env.CI,
  },
});
```

```typescript
// e2e/patient-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('æ‚£è€…åˆ›å»ºå’Œè¯„ä¼°æµç¨‹', () => {
  test('å®Œæ•´çš„æ‚£è€…åˆ›å»ºåˆ°è¯„ä¼°æµç¨‹', async ({ page }) => {
    // 1. è®¿é—®ä¸»é¡µ
    await page.goto('/');

    // 2. å¯¼èˆªåˆ°æ‚£è€…æ·»åŠ é¡µé¢
    await page.click('text=æ·»åŠ æ–°æ‚£è€…');
    await expect(page).toHaveURL('/patients/new');

    // 3. å¡«å†™æ‚£è€…ä¿¡æ¯
    await page.fill('input[name="name"]', 'E2Eæµ‹è¯•æ‚£è€…');
    await page.fill('input[name="age"]', '55');
    await page.selectOption('select[name="gender"]', 'ç”·');
    await page.selectOption('select[name="asaClass"]', 'II');

    // 4. æ·»åŠ ç”¨è¯
    await page.click('text=æ·»åŠ ç”¨è¯');
    await page.fill('input[name="medications.0"]', 'é˜¿å¸åŒ¹æ—');

    // 5. æäº¤è¡¨å•
    await page.click('button[type="submit"]');

    // 6. ç­‰å¾…å¯¼èˆªåˆ°æ‚£è€…åˆ—è¡¨
    await expect(page).toHaveURL('/patients');
    await expect(page.locator('text=E2Eæµ‹è¯•æ‚£è€…')).toBeVisible();

    // 7. ç‚¹å‡»å¼€å§‹è¯„ä¼°
    await page.click('text=E2Eæµ‹è¯•æ‚£è€…');
    await page.click('text=å¼€å§‹è¯„ä¼°');

    // 8. ç­‰å¾…è¯„ä¼°å®Œæˆï¼ˆæœ€å¤š30ç§’ï¼‰
    await page.waitForSelector('text=è¯„ä¼°å®Œæˆ', { timeout: 30000 });

    // 9. éªŒè¯è¯„ä¼°ç»“æœå­˜åœ¨
    await expect(page.locator('text=é£é™©è¯„ä¼°æŠ¥å‘Š')).toBeVisible();
    await expect(page.locator('text=é£é™©å› ç´ ')).toBeVisible();
  });
});
```

**package.jsonæ·»åŠ è„šæœ¬ï¼š**
```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui"
  }
}
```

---

### Week 5-6 äº¤ä»˜ç‰©

**ä»£ç äº¤ä»˜ï¼š**
- âœ… `vitest.config.ts` - æµ‹è¯•é…ç½®
- âœ… `shared/__tests__/schema.test.ts` - Schemaæµ‹è¯•
- âœ… `server/services/__tests__/` - ä¸šåŠ¡é€»è¾‘æµ‹è¯•
- âœ… `server/__tests__/api.test.ts` - APIæµ‹è¯•
- âœ… `e2e/*.spec.ts` - E2Eæµ‹è¯•

**åŠŸèƒ½å®Œæˆï¼š**
- âœ… æµ‹è¯•æ¡†æ¶å®Œæ•´æ­å»º
- âœ… 50ä¸ªæµ‹è¯•ç”¨ä¾‹
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°30%+
- âœ… CIå¯è¿è¡Œçš„æµ‹è¯•å¥—ä»¶

**æ–‡æ¡£è¾“å‡ºï¼š**
- ğŸ“„ `docs/æµ‹è¯•è¦†ç›–æŠ¥å‘Š.md`
- ğŸ“„ `docs/æµ‹è¯•ç¼–å†™æŒ‡å—.md`

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] `npm run test` æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] `npm run test:coverage` è¦†ç›–ç‡â‰¥30%
- [ ] `npm run test:e2e` E2Eæµ‹è¯•é€šè¿‡
- [ ] å…³é”®ä¸šåŠ¡é€»è¾‘æœ‰å•å…ƒæµ‹è¯•

---

## âš¡ Week 7-8: æ€§èƒ½ä¼˜åŒ–+ç”Ÿäº§å‡†å¤‡

**ç›®æ ‡ï¼š** å…³é”®æ€§èƒ½æå‡ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒå°±ç»ª

**æ€»å·¥ä½œé‡ï¼š** 15-20å°æ—¶

---

### Week 7: å…³é”®æ€§èƒ½ä¼˜åŒ– (16h)

#### ä»»åŠ¡19: å‰ç«¯æ€§èƒ½ä¼˜åŒ– (8h) - P1

**å­ä»»åŠ¡1: è·¯ç”±æ‡’åŠ è½½ (2h)**

**å®æ–½æ¸…å•ï¼š**
- [ ] ä½¿ç”¨React.lazyåŒ…è£…é¡µé¢ç»„ä»¶
- [ ] æ·»åŠ SuspenseåŠ è½½çŠ¶æ€
- [ ] ä¼˜åŒ–ä»£ç åˆ†å‰²ç‚¹

**ä»£ç å‚è€ƒï¼š**
```typescript
// client/src/App.tsx
import { lazy, Suspense } from 'react';
import { Switch, Route } from 'wouter';

// æ‡’åŠ è½½é¡µé¢ç»„ä»¶
const Dashboard = lazy(() => import("@/pages/dashboard"));
const Patients = lazy(() => import("@/pages/patients"));
const PatientForm = lazy(() => import("@/pages/patient-form"));
const DrugInteractions = lazy(() => import("@/pages/drug-interactions"));
const ClinicalGuidelines = lazy(() => import("@/pages/clinical-guidelines"));
const Chat = lazy(() => import("@/pages/chat"));
const Agents = lazy(() => import("@/pages/agents"));

// åŠ è½½çŠ¶æ€ç»„ä»¶
function PageLoader() {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
  );
}

function ProtectedRouter() {
  return (
    <Suspense fallback={<PageLoader />}>
      <Switch>
        <Route path="/" component={Dashboard} />
        <Route path="/dashboard" component={Dashboard} />
        <Route path="/patients/new" component={PatientForm} />
        <Route path="/patients" component={Patients} />
        <Route path="/agents" component={Agents} />
        <Route path="/chat" component={Chat} />
        <Route path="/drug-interactions" component={DrugInteractions} />
        <Route path="/clinical-guidelines" component={ClinicalGuidelines} />
        {/* ... */}
      </Switch>
    </Suspense>
  );
}
```

**å­ä»»åŠ¡2: React Queryç¼“å­˜ä¼˜åŒ– (2h)**

**ä»£ç å‚è€ƒï¼š**
```typescript
// client/src/lib/queryClient.ts
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryFn: getQueryFn({ on401: "throw" }),
      refetchInterval: false,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ - æ–°å¢
      cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ - æ–°å¢
      retry: 1, // ä¿®æ”¹ï¼šé‡è¯•1æ¬¡
    },
    mutations: {
      retry: false,
    },
  },
});
```

**å­ä»»åŠ¡3: å›¾ç‰‡æ‡’åŠ è½½å’Œä¼˜åŒ– (2h)**

**å®æ–½æ¸…å•ï¼š**
- [ ] ä½¿ç”¨loading="lazy"å±æ€§
- [ ] æ·»åŠ å›¾ç‰‡å‹ç¼©
- [ ] ä¼˜åŒ–åŒ»ç–—æŠ¥å‘Šå›¾ç‰‡å±•ç¤º

**å­ä»»åŠ¡4: Bundleåˆ†æå’Œä¼˜åŒ– (2h)**

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D rollup-plugin-visualizer
```

**é…ç½®ï¼š**
```typescript
// vite.config.ts
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(),
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true,
    }),
  ],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom'],
          'ui-vendor': ['@radix-ui/react-dialog', '@radix-ui/react-dropdown-menu'],
          'query-vendor': ['@tanstack/react-query'],
        },
      },
    },
  },
});
```

---

#### ä»»åŠ¡20: åç«¯æ€§èƒ½ä¼˜åŒ– (8h) - P1

**å­ä»»åŠ¡1: æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– (3h)**

**å®æ–½æ¸…å•ï¼š**
- [ ] åœ¨shared/schema.tsæ·»åŠ ç´¢å¼•
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»

**ä»£ç å‚è€ƒï¼š**
```typescript
// shared/schema.ts
import { index } from "drizzle-orm/pg-core";

export const patients = pgTable("patients", {
  // ... ç°æœ‰å­—æ®µ
}, (table) => ({
  nameIdx: index("patients_name_idx").on(table.name),
  createdAtIdx: index("patients_created_at_idx").on(table.createdAt),
}));

export const assessments = pgTable("assessments", {
  // ... ç°æœ‰å­—æ®µ
}, (table) => ({
  patientIdIdx: index("assessments_patient_id_idx").on(table.patientId),
  statusIdx: index("assessments_status_idx").on(table.status),
  createdAtIdx: index("assessments_created_at_idx").on(table.createdAt),
}));

export const agentLogs = pgTable("agent_logs", {
  // ... ç°æœ‰å­—æ®µ
}, (table) => ({
  assessmentIdIdx: index("agent_logs_assessment_id_idx").on(table.assessmentId),
}));

export const medicalReports = pgTable("medical_reports", {
  // ... ç°æœ‰å­—æ®µ
}, (table) => ({
  patientIdIdx: index("medical_reports_patient_id_idx").on(table.patientId),
}));
```

**è¿è¡Œè¿ç§»ï¼š**
```bash
npm run db:push
```

**å­ä»»åŠ¡2: APIå“åº”ç¼“å­˜ (3h)**

**å®æ–½æ¸…å•ï¼š**
- [ ] è¯ç‰©æ•°æ®ç¼“å­˜ï¼ˆé™æ€æ•°æ®ï¼‰
- [ ] ä¸´åºŠæŒ‡å—ç¼“å­˜
- [ ] æ·»åŠ ç¼“å­˜ä¸­é—´ä»¶

**ä»£ç å‚è€ƒï¼ˆç®€å•å†…å­˜ç¼“å­˜ï¼‰ï¼š**
```typescript
// server/middleware/cache.ts
interface CacheEntry {
  data: any;
  timestamp: number;
  ttl: number;
}

class SimpleCache {
  private cache: Map<string, CacheEntry> = new Map();

  set(key: string, data: any, ttl: number = 3600000) { // é»˜è®¤1å°æ—¶
    this.cache.set(key, {
      data,
      timestamp: Date.now(),
      ttl,
    });
  }

  get(key: string): any | null {
    const entry = this.cache.get(key);
    if (!entry) return null;

    if (Date.now() - entry.timestamp > entry.ttl) {
      this.cache.delete(key);
      return null;
    }

    return entry.data;
  }

  clear() {
    this.cache.clear();
  }
}

export const cache = new SimpleCache();

// ç¼“å­˜ä¸­é—´ä»¶
export function cacheMiddleware(ttl: number = 300000) { // é»˜è®¤5åˆ†é’Ÿ
  return (req: Request, res: Response, next: NextFunction) => {
    const key = `cache:${req.method}:${req.path}`;
    const cached = cache.get(key);

    if (cached) {
      return res.json(cached);
    }

    // åŠ«æŒres.json
    const originalJson = res.json.bind(res);
    res.json = (data: any) => {
      cache.set(key, data, ttl);
      return originalJson(data);
    };

    next();
  };
}
```

**åœ¨routes.tsä¸­ä½¿ç”¨ï¼š**
```typescript
import { cacheMiddleware } from './middleware/cache';

// ç¼“å­˜è¯ç‰©æœç´¢ç»“æœ
app.get("/api/drugs/search", cacheMiddleware(3600000), async (req, res) => {
  // ... åŸæœ‰é€»è¾‘
});

// ç¼“å­˜ä¸´åºŠæŒ‡å—
app.get("/api/clinical-guidelines", cacheMiddleware(3600000), async (req, res) => {
  // ... åŸæœ‰é€»è¾‘
});
```

**å­ä»»åŠ¡3: å¹¶å‘è¯·æ±‚ä¼˜åŒ– (2h)**

**å®æ–½æ¸…å•ï¼š**
- [ ] ä½¿ç”¨Promise.allå¹¶è¡Œå¤„ç†
- [ ] ä¼˜åŒ–AIæœåŠ¡è°ƒç”¨

**ä»£ç å‚è€ƒï¼š**
```typescript
// server/services/simple-agents.ts - ä¼˜åŒ–éƒ¨åˆ†
async runAssessment(patientId: number): Promise<Assessment> {
  // ... å‰é¢çš„ä»£ç 

  // å¹¶è¡Œæ‰§è¡Œå¤šä¸ªç‹¬ç«‹çš„åˆ†æä»»åŠ¡
  const [riskFactors, drugInteractions, guidelines] = await Promise.all([
    this.generateRiskFactorsFromPatientData(enhancedPatientData),
    this.analyzeDrugInteractions(patient.medications),
    this.fetchClinicalGuidelines(patient),
  ]);

  // ... åç»­å¤„ç†
}
```

---

### Week 8: ç”Ÿäº§ç¯å¢ƒå‡†å¤‡ (12h)

#### ä»»åŠ¡21: ä»£ç è§„èŒƒ (3h) - P2

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D eslint prettier eslint-config-prettier eslint-plugin-react
npm install -D @typescript-eslint/parser @typescript-eslint/eslint-plugin
npm install -D husky lint-staged
```

**åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š**
```bash
# ESLinté…ç½®
cat > .eslintrc.json << 'EOF'
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "rules": {
    "no-console": "warn",
    "@typescript-eslint/no-explicit-any": "warn",
    "react/prop-types": "off",
    "react/react-in-jsx-scope": "off"
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  }
}
EOF

# Prettieré…ç½®
cat > .prettierrc << 'EOF'
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "arrowParens": "always"
}
EOF

# Prettier ignore
cat > .prettierignore << 'EOF'
node_modules
dist
build
coverage
*.min.js
EOF
```

**é…ç½®Huskyå’ŒLint-stagedï¼š**
```bash
npx husky init
echo "npx lint-staged" > .husky/pre-commit
```

```json
// package.json æ·»åŠ 
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  },
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "format": "prettier --write \"**/*.{ts,tsx,json,md}\""
  }
}
```

---

#### ä»»åŠ¡22: DockeråŒ– (4h) - P1

**åˆ›å»ºæ–‡ä»¶ï¼š**
```dockerfile
# Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ–
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:18-alpine

WORKDIR /app

# åªå¤åˆ¶ç”Ÿäº§ä¾èµ–
COPY package*.json ./
RUN npm ci --production

# ä»builderå¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist ./dist

# æš´éœ²ç«¯å£
EXPOSE 3001

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=40s \
  CMD node -e "require('http').get('http://localhost:3001/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"

# å¯åŠ¨åº”ç”¨
CMD ["npm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@db:5432/anesthesia_guardian
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - SESSION_SECRET=${SESSION_SECRET}
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: postgres:14-alpine
    environment:
      - POSTGRES_DB=anesthesia_guardian
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped

volumes:
  postgres_data:
```

```.dockerignore
node_modules
npm-debug.log
dist
.git
.env
.env.local
logs
*.log
.DS_Store
coverage
.vscode
.idea
```

**æµ‹è¯•Dockeræ„å»ºï¼š**
```bash
# æ„å»ºé•œåƒ
docker build -t anesthesia-guardian .

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æ£€æŸ¥å¥åº·çŠ¶æ€
docker-compose ps
curl http://localhost:3001/health
```

---

#### ä»»åŠ¡23: éƒ¨ç½²æ–‡æ¡£å’Œè„šæœ¬ (3h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `docs/ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—.md`
- `scripts/deploy.sh`
- `scripts/backup-db.sh`

**éƒ¨ç½²æŒ‡å—å†…å®¹è¦ç‚¹ï¼š**
- ç¯å¢ƒå˜é‡é…ç½®æ£€æŸ¥æ¸…å•
- æ•°æ®åº“è¿ç§»æ­¥éª¤
- Dockeréƒ¨ç½²æµç¨‹
- Nginxåå‘ä»£ç†é…ç½®
- SSLè¯ä¹¦é…ç½®
- å¤‡ä»½å’Œæ¢å¤æµç¨‹

**éƒ¨ç½²è„šæœ¬ç¤ºä¾‹ï¼š**
```bash
# scripts/deploy.sh
#!/bin/bash

set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½² AnesGuardian..."

# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo "ğŸ“‹ æ£€æŸ¥ç¯å¢ƒå˜é‡..."
if [ -z "$GEMINI_API_KEY" ]; then
  echo "âŒ é”™è¯¯: GEMINI_API_KEY æœªè®¾ç½®"
  exit 1
fi

if [ -z "$DATABASE_URL" ]; then
  echo "âŒ é”™è¯¯: DATABASE_URL æœªè®¾ç½®"
  exit 1
fi

echo "âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥é€šè¿‡"

# 2. æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# 3. å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm ci

# 4. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
npm run test

# 5. æ„å»ºåº”ç”¨
echo "ğŸ”¨ æ„å»ºåº”ç”¨..."
npm run build

# 6. æ•°æ®åº“è¿ç§»
echo "ğŸ—„ï¸  æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
npm run db:push

# 7. é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
if [ -f "docker-compose.yml" ]; then
  docker-compose down
  docker-compose up -d
else
  pm2 restart anesthesia-guardian || pm2 start dist/index.js --name anesthesia-guardian
fi

# 8. å¥åº·æ£€æŸ¥
echo "â¤ï¸  å¥åº·æ£€æŸ¥..."
sleep 10
curl -f http://localhost:3001/health || {
  echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥"
  exit 1
}

echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
```

---

#### ä»»åŠ¡24: ç”Ÿäº§ç¯å¢ƒéªŒè¯ (2h) - P0

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `docs/ç”Ÿäº§ç¯å¢ƒä¸Šçº¿æ£€æŸ¥æ¸…å•.md`

**æ£€æŸ¥æ¸…å•å†…å®¹ï¼š**

**ç¯å¢ƒé…ç½®æ£€æŸ¥ï¼š**
- [ ] æ‰€æœ‰å¿…éœ€ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] SESSION_SECRETå·²è®¾ç½®ä¸ºå¼ºéšæœºå€¼
- [ ] ALLOWED_ORIGINSé…ç½®äº†æ­£ç¡®çš„åŸŸå
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•æˆåŠŸ
- [ ] Gemini APIè¿æ¥æµ‹è¯•æˆåŠŸ

**å®‰å…¨æ£€æŸ¥ï¼š**
- [ ] HTTPSå·²å¯ç”¨
- [ ] æ‰€æœ‰APIæœ‰é€Ÿç‡é™åˆ¶
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†ç”Ÿæ•ˆ
- [ ] æ•æ„Ÿä¿¡æ¯ä¸åœ¨æ—¥å¿—ä¸­æš´éœ²
- [ ] CORSé…ç½®æ­£ç¡®

**æ€§èƒ½æ£€æŸ¥ï¼š**
- [ ] é¦–å±åŠ è½½æ—¶é—´<3ç§’
- [ ] APIå¹³å‡å“åº”æ—¶é—´<5ç§’
- [ ] æ•°æ®åº“æŸ¥è¯¢æœ‰ç´¢å¼•
- [ ] é™æ€èµ„æºç¼“å­˜é…ç½®

**ç›‘æ§æ£€æŸ¥ï¼š**
- [ ] æ—¥å¿—ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- [ ] /healthç«¯ç‚¹è¿”å›200
- [ ] /metricsç«¯ç‚¹è¿”å›æ•°æ®
- [ ] å‘Šè­¦ç³»ç»Ÿé…ç½®å®Œæˆ

**åŠŸèƒ½æ£€æŸ¥ï¼š**
- [ ] æ‚£è€…åˆ›å»ºæµç¨‹æ­£å¸¸
- [ ] é£é™©è¯„ä¼°åŠŸèƒ½æ­£å¸¸
- [ ] AIæœåŠ¡è°ƒç”¨æˆåŠŸ
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

**å¤‡ä»½æ£€æŸ¥ï¼š**
- [ ] æ•°æ®åº“å¤‡ä»½è„šæœ¬å°±ç»ª
- [ ] å¤‡ä»½æ¢å¤æµ‹è¯•é€šè¿‡
- [ ] å›æ»šæ–¹æ¡ˆå‡†å¤‡å®Œæˆ

---

### Week 7-8 äº¤ä»˜ç‰©

**ä»£ç äº¤ä»˜ï¼š**
- âœ… å‰ç«¯æ‡’åŠ è½½å’Œæ€§èƒ½ä¼˜åŒ–
- âœ… åç«¯æ•°æ®åº“ç´¢å¼•å’Œç¼“å­˜
- âœ… ESLintå’ŒPrettieré…ç½®
- âœ… Dockerå’Œdocker-composeé…ç½®
- âœ… éƒ¨ç½²è„šæœ¬å’Œæ–‡æ¡£

**åŠŸèƒ½å®Œæˆï¼š**
- âœ… é¦–å±åŠ è½½æ—¶é—´<2ç§’
- âœ… APIå“åº”æ—¶é—´ä¼˜åŒ–50%
- âœ… Dockeréƒ¨ç½²å°±ç»ª
- âœ… ä»£ç è§„èŒƒå·¥å…·é…ç½®
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®å®Œæˆ

**æ–‡æ¡£è¾“å‡ºï¼š**
- ğŸ“„ `docs/ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—.md`
- ğŸ“„ `docs/ç”Ÿäº§ç¯å¢ƒä¸Šçº¿æ£€æŸ¥æ¸…å•.md`
- ğŸ“„ `docs/æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š.md`

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] Lighthouseæ€§èƒ½åˆ†æ•°â‰¥85
- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] ä»£ç é€šè¿‡lintæ£€æŸ¥
- [ ] ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•å…¨éƒ¨é€šè¿‡

---

## ğŸ“ˆ æ€»ç»“å’Œåç»­è®¡åˆ’

### 8å‘¨ä¼˜åŒ–æˆæœ

**é¢„æœŸè¾¾æˆæŒ‡æ ‡ï¼š**

| ç±»åˆ« | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| **å®‰å…¨æ€§** |
| APIé˜²æŠ¤ | æ—  | é€Ÿç‡é™åˆ¶+è¾“å…¥éªŒè¯ | âˆ |
| é”™è¯¯å¤„ç† | ä¸ç»Ÿä¸€ | ç»Ÿä¸€ä¸­é—´ä»¶ | 100% |
| **å¯è§‚æµ‹æ€§** |
| æ—¥å¿—ç³»ç»Ÿ | console.log | Winstonç»“æ„åŒ– | 500% |
| å¥åº·æ£€æŸ¥ | æ—  | å®Œæ•´ç›‘æ§ | âˆ |
| **è´¨é‡** |
| æµ‹è¯•è¦†ç›–ç‡ | 0% | 30%+ | +30% |
| ä»£ç è§„èŒƒ | æ—  | ESLint+Prettier | âˆ |
| **æ€§èƒ½** |
| é¦–å±åŠ è½½ | 3-4s | <2s | â†“50% |
| APIå“åº” | 2-8s | 1-4s | â†“50% |

---

### ç”Ÿäº§ä¸Šçº¿å‡†å¤‡åº¦è¯„ä¼°

**âœ… å·²å®Œæˆï¼ˆä¸Šçº¿å¿…å¤‡ï¼‰ï¼š**
- å®‰å…¨åŠ å›ºï¼ˆé€Ÿç‡é™åˆ¶ã€è¾“å…¥éªŒè¯ã€é”™è¯¯å¤„ç†ï¼‰
- ç›‘æ§æ—¥å¿—ï¼ˆç»“æ„åŒ–æ—¥å¿—ã€å¥åº·æ£€æŸ¥ã€å‘Šè­¦ï¼‰
- æ ¸å¿ƒæµ‹è¯•ï¼ˆ30%è¦†ç›–ç‡ã€å…³é”®è·¯å¾„æµ‹è¯•ï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆå…³é”®æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼‰
- ç”Ÿäº§é…ç½®ï¼ˆDockerã€éƒ¨ç½²è„šæœ¬ã€æ£€æŸ¥æ¸…å•ï¼‰

**âš ï¸ å¾…è§‚å¯Ÿï¼ˆä¸Šçº¿åæŒç»­æ”¹è¿›ï¼‰ï¼š**
- æµ‹è¯•è¦†ç›–ç‡æå‡åˆ°50%+
- æ›´å…¨é¢çš„E2Eæµ‹è¯•
- CI/CDè‡ªåŠ¨åŒ–æµç¨‹
- æ›´è¯¦ç»†çš„ç›‘æ§æŒ‡æ ‡

**å»ºè®®ä¸Šçº¿æ—¶é—´è¡¨ï¼š**
- Week 8ç»“æŸï¼šå®Œæˆæ‰€æœ‰ä¼˜åŒ–ä»»åŠ¡
- Week 9ï¼ˆç¬¬1å‘¨ï¼‰ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’ŒéªŒè¯
- Week 9ï¼ˆç¬¬2å‘¨ï¼‰ï¼šå¯†åˆ‡ç›‘æ§ï¼Œå¿«é€Ÿè¿­ä»£ä¿®å¤é—®é¢˜

---

### åç»­ä¼˜åŒ–è®¡åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰

**ç¬¬äºŒé˜¶æ®µä¼˜åŒ–ï¼ˆä¸Šçº¿å1-2ä¸ªæœˆï¼‰ï¼š**
1. **CI/CDå®Œå–„**ï¼ˆ2å‘¨ï¼‰
   - GitHub Actionså·¥ä½œæµ
   - è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²
   - ç¯å¢ƒç®¡ç†

2. **æµ‹è¯•æå‡**ï¼ˆ2å‘¨ï¼‰
   - æµ‹è¯•è¦†ç›–ç‡æå‡åˆ°50%
   - æ›´å¤šE2Eæµ‹è¯•ç”¨ä¾‹
   - æ€§èƒ½æµ‹è¯•

3. **ç›‘æ§å¢å¼º**ï¼ˆ1å‘¨ï¼‰
   - Sentryé›†æˆï¼ˆå¯é€‰ï¼‰
   - è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡
   - ç›‘æ§çœ‹æ¿

**ç¬¬ä¸‰é˜¶æ®µä¼˜åŒ–ï¼ˆä¸Šçº¿å3-6ä¸ªæœˆï¼‰ï¼š**
1. **åŠŸèƒ½å¢å¼º**
   - PWAæ”¯æŒ
   - ç§»åŠ¨ç«¯ä¼˜åŒ–
   - æ•°æ®åˆ†æçœ‹æ¿

2. **æ€§èƒ½è¿›é˜¶**
   - Redisç¼“å­˜
   - CDNé›†æˆ
   - æ›´ç»†ç²’åº¦çš„æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“ æ”¯æŒå’Œèµ„æº

### é‡åˆ°é—®é¢˜æ—¶

1. **æŸ¥çœ‹æ–‡æ¡£**
   - é¡¹ç›®README.md
   - docs/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡æ¡£
   - CLAUDE.md

2. **ä½¿ç”¨ä¸“ç”¨agents**
   - medical-safety-auditor - åŒ»ç–—é€»è¾‘é—®é¢˜
   - api-security-reviewer - å®‰å…¨é—®é¢˜
   - performance-optimizer - æ€§èƒ½é—®é¢˜
   - test-coverage-guardian - æµ‹è¯•é—®é¢˜
   - ai-integration-validator - AIé›†æˆé—®é¢˜

3. **æŸ¥çœ‹æ—¥å¿—**
   - logs/error-*.log - é”™è¯¯æ—¥å¿—
   - logs/combined-*.log - ç»¼åˆæ—¥å¿—
   - /metricsç«¯ç‚¹ - å®æ—¶æŒ‡æ ‡

4. **å¥åº·æ£€æŸ¥**
   - /health - åŸºç¡€çŠ¶æ€
   - /health/detailed - è¯¦ç»†çŠ¶æ€

---

## ğŸ¯ å…³é”®æˆåŠŸå› ç´ 

1. **æ—¶é—´ç®¡ç†**
   - ä¸¥æ ¼æŒ‰ç…§æ¯å‘¨è®¡åˆ’æ‰§è¡Œ
   - ä¼˜å…ˆå®ŒæˆP0ä»»åŠ¡
   - åŠæ—¶è°ƒæ•´è®¡åˆ’

2. **è´¨é‡ä¿è¯**
   - æ¯å‘¨ä½¿ç”¨agentså®¡æŸ¥ä»£ç 
   - å®Œæˆä¸€ä¸ªä»»åŠ¡å†å¼€å§‹ä¸‹ä¸€ä¸ª
   - æ¯å‘¨æœ«éªŒæ”¶æˆæœ

3. **æ–‡æ¡£è®°å½•**
   - è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
   - æ›´æ–°æ–‡æ¡£
   - å‡†å¤‡çŸ¥è¯†åº“

4. **æŒç»­å­¦ä¹ **
   - è¾¹åšè¾¹å­¦
   - å‚è€ƒæœ€ä½³å®è·µ
   - ä¸è¿½æ±‚å®Œç¾ï¼Œå…ˆå®Œæˆå†ä¼˜åŒ–

---

**ç¥ä½ ä¼˜åŒ–é¡ºåˆ©ï¼8å‘¨åç³»ç»Ÿå°†æ›´åŠ ç¨³å®šã€å®‰å…¨ã€é«˜æ€§èƒ½ï¼** ğŸš€
