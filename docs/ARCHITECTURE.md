# ç³»ç»Ÿæ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° AnesGuardian ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [AI ä»£ç†ç³»ç»Ÿ](#ai-ä»£ç†ç³»ç»Ÿ)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è§ˆ

AnesGuardian æ˜¯ä¸€ä¸ªåŸºäº AI çš„å›´æœ¯æœŸæ™ºèƒ½å†³ç­–æ”¯æŒç³»ç»Ÿï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„å…¨æ ˆæ¶æ„ã€‚

### æ¶æ„ç‰¹ç‚¹

- **å‰åç«¯åˆ†ç¦»**: React SPA + Express API Server
- **ç±»å‹å®‰å…¨**: å…¨æ ˆ TypeScript
- **å®æ—¶é€šä¿¡**: WebSocket æ”¯æŒ
- **AI é©±åŠ¨**: å¤šæ™ºèƒ½ä½“ååŒå·¥ä½œ
- **æ¨¡å—åŒ–è®¾è®¡**: é«˜å†…èšã€ä½è€¦åˆ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯å±‚ (Client)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          React 18 + TypeScript                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Pages     â”‚  â”‚ Components â”‚  â”‚  Contexts â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Hooks     â”‚  â”‚   Utils    â”‚  â”‚    Lib    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    HTTP/WebSocket
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å™¨å±‚ (Server)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Express + TypeScript (ESM)               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Routes   â”‚  â”‚  Services  â”‚  â”‚  Storage  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ•°æ®å±‚ (Database)     â”‚  â”‚   AI æœåŠ¡å±‚ (AI)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PostgreSQL     â”‚   â”‚  â”‚  â”‚ Google Gemini  â”‚  â”‚
â”‚  â”‚   Drizzle ORM    â”‚   â”‚  â”‚  â”‚  Multi-Agent   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚æ¶æ„

#### 1. è¡¨ç°å±‚ (Presentation Layer)
- **èŒè´£**: ç”¨æˆ·ç•Œé¢æ¸²æŸ“å’Œäº¤äº’
- **æŠ€æœ¯**: React 18, Tailwind CSS, shadcn/ui
- **ç‰¹ç‚¹**: ç»„ä»¶åŒ–ã€å“åº”å¼ã€ç±»å‹å®‰å…¨

#### 2. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- **èŒè´£**: API è·¯ç”±ã€ä¸šåŠ¡é€»è¾‘ã€AI æœåŠ¡
- **æŠ€æœ¯**: Express, TypeScript, Google Gemini
- **ç‰¹ç‚¹**: RESTful APIã€æ¨¡å—åŒ–æœåŠ¡ã€AI é›†æˆ

#### 3. æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- **èŒè´£**: æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€äº‹åŠ¡ç®¡ç†
- **æŠ€æœ¯**: PostgreSQL, Drizzle ORM
- **ç‰¹ç‚¹**: ç±»å‹å®‰å…¨ã€å…³ç³»æ˜ å°„ã€è‡ªåŠ¨è¿ç§»

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒæ¡†æ¶
React 18.3.1              // UI æ¡†æ¶
TypeScript 5.6.3          // ç±»å‹ç³»ç»Ÿ
Vite 5.4.19              // æ„å»ºå·¥å…·

// çŠ¶æ€ç®¡ç†
TanStack Query 5.60.5     // æœåŠ¡ç«¯çŠ¶æ€
React Hook Form 7.55.0    // è¡¨å•çŠ¶æ€

// UI ç»„ä»¶
Tailwind CSS 3.4.17       // æ ·å¼æ¡†æ¶
shadcn/ui (Radix UI)      // ç»„ä»¶åº“
Lucide React 0.453.0      // å›¾æ ‡åº“
Framer Motion 11.13.1     // åŠ¨ç”»åº“

// è·¯ç”±å’Œå¯¼èˆª
Wouter 3.3.5             // å®¢æˆ·ç«¯è·¯ç”±

// å·¥å…·åº“
Zod 3.24.2               // æ•°æ®éªŒè¯
date-fns 3.6.0           // æ—¥æœŸå¤„ç†
Recharts 2.15.2          // å›¾è¡¨åº“
```

### åç«¯æŠ€æœ¯æ ˆ

```typescript
// è¿è¡Œæ—¶å’Œæ¡†æ¶
Node.js 18+              // è¿è¡Œç¯å¢ƒ
Express 4.21.2           // Web æ¡†æ¶
TypeScript 5.6.3         // ç±»å‹ç³»ç»Ÿ

// æ•°æ®åº“
PostgreSQL 14+           // å…³ç³»å‹æ•°æ®åº“
Drizzle ORM 0.39.1       // ORM æ¡†æ¶
@neondatabase/serverless // Serverless è¿æ¥

// AI æœåŠ¡
Google Gemini API        // AI æ¨¡å‹
@google/generative-ai    // SDK
Tesseract.js 6.0.1       // OCR è¯†åˆ«

// ä¸­é—´ä»¶
CORS 2.8.5              // è·¨åŸŸå¤„ç†
Multer 2.0.1            // æ–‡ä»¶ä¸Šä¼ 
Express Session          // ä¼šè¯ç®¡ç†

// å·¥å…·
dotenv 17.2.3           // ç¯å¢ƒå˜é‡
Zod 3.24.2              // æ•°æ®éªŒè¯
```

---

## ğŸ§© æ ¸å¿ƒæ¨¡å—

### å‰ç«¯æ¨¡å—ç»“æ„

```
client/src/
â”œâ”€â”€ components/          # UI ç»„ä»¶ (58ä¸ª)
â”‚   â”œâ”€â”€ ui/             # åŸºç¡€ UI ç»„ä»¶ (shadcn/ui)
â”‚   â”œâ”€â”€ AssessmentDashboard.tsx
â”‚   â”œâ”€â”€ PatientForm.tsx
â”‚   â”œâ”€â”€ DrugInteractionPanel.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶ (10ä¸ª)
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ Patients.tsx
â”‚   â”œâ”€â”€ Assessment.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ contexts/           # React Context
â”‚   â””â”€â”€ AuthContext.tsx
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ use-mobile.tsx
â”‚   â””â”€â”€ use-toast.ts
â”œâ”€â”€ lib/                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ utils.ts
â””â”€â”€ utils/              # è¾…åŠ©å·¥å…·
    â””â”€â”€ enhanced-report-generator.ts
```

### åç«¯æ¨¡å—ç»“æ„

```
server/
â”œâ”€â”€ index.ts            # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ routes.ts           # API è·¯ç”±
â”œâ”€â”€ db.ts              # æ•°æ®åº“é…ç½®
â”œâ”€â”€ storage.ts         # æ–‡ä»¶å­˜å‚¨
â””â”€â”€ services/          # ä¸šåŠ¡æœåŠ¡ (11ä¸ª)
    â”œâ”€â”€ ai-service.ts                    # AI åŸºç¡€æœåŠ¡
    â”œâ”€â”€ orchestrator-service.ts          # åè°ƒå™¨ä»£ç†
    â”œâ”€â”€ emr-extractor-service.ts         # ç—…å†æå–ä»£ç†
    â”œâ”€â”€ risk-assessor-service.ts         # é£é™©è¯„ä¼°ä»£ç†
    â”œâ”€â”€ drug-analyzer-service.ts         # è¯ç‰©åˆ†æä»£ç†
    â”œâ”€â”€ guideline-consultant-service.ts  # æŒ‡å—å’¨è¯¢ä»£ç†
    â”œâ”€â”€ quality-checker-service.ts       # è´¨é‡æ£€æŸ¥ä»£ç†
    â”œâ”€â”€ drug-enhancement-service.ts      # è¯ç‰©å¢å¼ºæœåŠ¡
    â”œâ”€â”€ medical-record-service.ts        # åŒ»ç–—è®°å½•æœåŠ¡
    â”œâ”€â”€ ocr-service.ts                   # OCR æœåŠ¡
    â””â”€â”€ report-generator-service.ts      # æŠ¥å‘Šç”ŸæˆæœåŠ¡
```

---

## ğŸ”„ æ•°æ®æµ

### 1. æ‚£è€…è¯„ä¼°æµç¨‹

```
ç”¨æˆ·æ“ä½œ
  â”‚
  â”œâ”€â†’ é€‰æ‹©æ‚£è€…
  â”‚     â”‚
  â”‚     â”œâ”€â†’ GET /api/patients/:id
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â†’ Database Query
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â†’ è¿”å›æ‚£è€…æ•°æ®
  â”‚     â”‚
  â”œâ”€â†’ å¼€å§‹è¯„ä¼°
  â”‚     â”‚
  â”‚     â”œâ”€â†’ POST /api/assessments
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â†’ åˆ›å»ºè¯„ä¼°è®°å½•
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â†’ åˆå§‹åŒ–åè°ƒå™¨ä»£ç†
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â†’ å¯åŠ¨ç—…å†æå–ä»£ç†
  â”‚     â”‚     â”‚     â”œâ”€â†’ å¯åŠ¨é£é™©è¯„ä¼°ä»£ç†
  â”‚     â”‚     â”‚     â”œâ”€â†’ å¯åŠ¨è¯ç‰©åˆ†æä»£ç†
  â”‚     â”‚     â”‚     â”œâ”€â†’ å¯åŠ¨æŒ‡å—å’¨è¯¢ä»£ç†
  â”‚     â”‚     â”‚     â””â”€â†’ å¯åŠ¨è´¨é‡æ£€æŸ¥ä»£ç†
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â†’ è¿”å›è¯„ä¼° ID
  â”‚     â”‚
  â”œâ”€â†’ è½®è¯¢è¯„ä¼°çŠ¶æ€
  â”‚     â”‚
  â”‚     â””â”€â†’ GET /api/assessments/:id
  â”‚           â”‚
  â”‚           â””â”€â†’ è¿”å›å®æ—¶çŠ¶æ€å’Œç»“æœ
  â”‚
  â””â”€â†’ æ˜¾ç¤ºè¯„ä¼°æŠ¥å‘Š
```

### 2. è¯ç‰©ç›¸äº’ä½œç”¨åˆ†ææµç¨‹

```
ç”¨æˆ·è¾“å…¥è¯ç‰©åˆ—è¡¨
  â”‚
  â””â”€â†’ POST /api/drugs/interactions
        â”‚
        â”œâ”€â†’ æ•°æ®åº“æŸ¥è¯¢åŒ¹é…è¯ç‰©
        â”‚     â”‚
        â”‚     â””â”€â†’ è¿”å›è¯ç‰©è¯¦ç»†ä¿¡æ¯
        â”‚
        â”œâ”€â†’ ä¸¤ä¸¤ç»„åˆåˆ†æ
        â”‚     â”‚
        â”‚     â”œâ”€â†’ ç¬¬ä¸€æ­¥ï¼šAIåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸äº’ä½œç”¨
        â”‚     â”‚     â”‚
        â”‚     â”‚     â””â”€â†’ Gemini API: "æ˜¯" or "å¦"
        â”‚     â”‚
        â”‚     â””â”€â†’ ç¬¬äºŒæ­¥ï¼šè·å–è¯¦ç»†åˆ†æï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        â”‚           â”‚
        â”‚           â””â”€â†’ Gemini API: è¯¦ç»†åˆ†ææŠ¥å‘Š
        â”‚
        â””â”€â†’ æ±‡æ€»æ‰€æœ‰ç›¸äº’ä½œç”¨
              â”‚
              â””â”€â†’ è¿”å›åˆ†æç»“æœ
```

### 3. åŒ»ç–—è®°å½•å¤„ç†æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
  â”‚
  â””â”€â†’ POST /api/medical-reports/analyze
        â”‚
        â”œâ”€â†’ æ–‡ä»¶éªŒè¯å’Œå­˜å‚¨
        â”‚
        â”œâ”€â†’ å¤šæ¨¡æ€ AI åˆ†æï¼ˆä¼˜å…ˆï¼‰
        â”‚     â”‚
        â”‚     â”œâ”€â†’ Gemini Vision API
        â”‚     â”‚     â”‚
        â”‚     â”‚     â””â”€â†’ ç›´æ¥ä»å›¾åƒæå–ä¿¡æ¯
        â”‚     â”‚
        â”‚     â””â”€â†’ è¿”å›ç»“æ„åŒ–æ•°æ®
        â”‚
        â”œâ”€â†’ OCR å¤‡ç”¨æ–¹æ¡ˆ
        â”‚     â”‚
        â”‚     â”œâ”€â†’ Tesseract.js è¯†åˆ«æ–‡å­—
        â”‚     â”‚     â”‚
        â”‚     â”‚     â””â”€â†’ æå–æ–‡æœ¬å†…å®¹
        â”‚     â”‚
        â”‚     â””â”€â†’ AI ä¿¡æ¯æå–
        â”‚           â”‚
        â”‚           â””â”€â†’ ç»“æ„åŒ–æ•°æ®ç”Ÿæˆ
        â”‚
        â””â”€â†’ è¿”å›åˆ†æç»“æœ
              â”‚
              â””â”€â†’ å‰ç«¯åŒ»ç”Ÿå®¡æ ¸ç•Œé¢
```

---

## ğŸ¤– AI ä»£ç†ç³»ç»Ÿ

### å¤šæ™ºèƒ½ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åè°ƒå™¨ä»£ç† (Orchestrator)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - ç®¡ç†è¯„ä¼°å·¥ä½œæµ                              â”‚  â”‚
â”‚  â”‚ - åè°ƒå„ä»£ç†å·¥ä½œ                              â”‚  â”‚
â”‚  â”‚ - æ±‡æ€»åˆ†æç»“æœ                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç—…å†æå–ä»£ç†  â”‚ â”‚ é£é™©è¯„ä¼°ä»£ç† â”‚ â”‚ è¯ç‰©åˆ†æä»£ç† â”‚
â”‚               â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ - OCRè¯†åˆ«    â”‚ â”‚ - æ°”é“é£é™©   â”‚ â”‚ - ç›¸äº’ä½œç”¨   â”‚
â”‚ - AIæå–     â”‚ â”‚ - å¿ƒè¡€ç®¡é£é™© â”‚ â”‚ - åœè¯å»ºè®®   â”‚
â”‚ - æ•°æ®ç»“æ„åŒ– â”‚ â”‚ - è¡€æ “é£é™©   â”‚ â”‚ - ç¦å¿Œç—‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡å—å’¨è¯¢ä»£ç†  â”‚ â”‚ è´¨é‡æ£€æŸ¥ä»£ç† â”‚ â”‚   æŠ¥å‘Šç”Ÿæˆ   â”‚
â”‚               â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ - æŒ‡å—æœç´¢   â”‚ â”‚ - ç»“æœéªŒè¯   â”‚ â”‚ - ç»¼åˆæŠ¥å‘Š   â”‚
â”‚ - ç›¸å…³æ€§è¯„åˆ† â”‚ â”‚ - äº¤å‰æ£€æŸ¥   â”‚ â”‚ - å»ºè®®æ±‡æ€»   â”‚
â”‚ - æ¨èç”Ÿæˆ   â”‚ â”‚ - è´¨é‡ä¿è¯   â”‚ â”‚ - PDFå¯¼å‡º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç†é€šä¿¡æœºåˆ¶

```typescript
// ä»£ç†æ¥å£å®šä¹‰
interface Agent {
  name: string;
  status: 'idle' | 'active' | 'completed' | 'failed';
  progress: number;
  execute(input: any): Promise<any>;
  onStatusChange: (callback: Function) => void;
}

// åè°ƒå™¨æ¨¡å¼
class OrchestratorService {
  private agents: Map<string, Agent>;
  
  async orchestrate(patientData: any) {
    // 1. åˆå§‹åŒ–æ‰€æœ‰ä»£ç†
    await this.initializeAgents();
    
    // 2. å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»£ç†
    const results = await Promise.all([
      this.agents.get('emr-extractor').execute(patientData),
      this.agents.get('risk-assessor').execute(patientData),
      this.agents.get('drug-analyzer').execute(patientData)
    ]);
    
    // 3. ä¸²è¡Œæ‰§è¡Œä¾èµ–ä»£ç†
    const guidelines = await this.agents
      .get('guideline-consultant')
      .execute(results);
    
    // 4. è´¨é‡æ£€æŸ¥
    const validated = await this.agents
      .get('quality-checker')
      .execute({ results, guidelines });
    
    // 5. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    return this.generateReport(validated);
  }
}
```

### AI æœåŠ¡é…ç½®

```typescript
// Google Gemini é…ç½®
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

// ä¸åŒä»»åŠ¡ä½¿ç”¨ä¸åŒæ¨¡å‹
const MODELS = {
  vision: 'gemini-1.5-flash',      // å›¾åƒåˆ†æ
  chat: 'gemini-2.5-flash-lite',   // å¯¹è¯é—®ç­”
  analysis: 'gemini-1.5-pro'       // æ·±åº¦åˆ†æ
};

// æ™ºèƒ½é‡è¯•æœºåˆ¶
async function generateWithRetry(prompt: string) {
  const tokenLimits = [2048, 4096, 8192];
  
  for (const maxTokens of tokenLimits) {
    const result = await model.generateContent({
      contents: [{ parts: [{ text: prompt }] }],
      generationConfig: { maxOutputTokens: maxTokens }
    });
    
    if (!isTruncated(result)) {
      return result;
    }
  }
  
  throw new Error('AI response truncated even at max tokens');
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     patients     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚
â”‚ name             â”‚
â”‚ age              â”‚
â”‚ gender           â”‚
â”‚ surgery_type     â”‚
â”‚ asa_class        â”‚
â”‚ medical_history  â”‚â”€â”€â”€â”
â”‚ medications      â”‚   â”‚
â”‚ allergies        â”‚   â”‚
â”‚ vital_signs      â”‚   â”‚
â”‚ lab_results      â”‚   â”‚
â”‚ created_at       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             â”‚
         â”‚ 1:N         â”‚
         â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   assessments    â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ id (PK)          â”‚   â”‚
â”‚ patient_id (FK)  â”‚â”€â”€â”€â”˜
â”‚ status           â”‚
â”‚ overall_risk     â”‚
â”‚ risk_factors     â”‚
â”‚ drug_interactionsâ”‚
â”‚ clinical_guidelinesâ”‚
â”‚ recommendations  â”‚
â”‚ agent_status     â”‚
â”‚ created_at       â”‚
â”‚ completed_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   agent_logs     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚
â”‚ assessment_id(FK)â”‚
â”‚ agent_name       â”‚
â”‚ action           â”‚
â”‚ status           â”‚
â”‚ result           â”‚
â”‚ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      drugs       â”‚       â”‚ medical_reports  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚       â”‚ id (PK)          â”‚
â”‚ name (UNIQUE)    â”‚       â”‚ patient_id (FK)  â”‚
â”‚ aliases          â”‚       â”‚ report_type      â”‚
â”‚ category         â”‚       â”‚ upload_method    â”‚
â”‚ stop_guideline   â”‚       â”‚ original_image   â”‚
â”‚ contraindicationsâ”‚       â”‚ extracted_text   â”‚
â”‚ side_effects     â”‚       â”‚ manual_text      â”‚
â”‚ created_at       â”‚       â”‚ analyzed_data    â”‚
â”‚ updated_at       â”‚       â”‚ risk_factors     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ recommendations  â”‚
                           â”‚ created_at       â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç´¢å¼•ç­–ç•¥

```sql
-- ä¸»é”®ç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
-- patients.id
-- assessments.id
-- drugs.id
-- agent_logs.id
-- medical_reports.id

-- å¤–é”®ç´¢å¼•
CREATE INDEX idx_assessments_patient_id ON assessments(patient_id);
CREATE INDEX idx_agent_logs_assessment_id ON agent_logs(assessment_id);
CREATE INDEX idx_medical_reports_patient_id ON medical_reports(patient_id);

-- æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_patients_name ON patients(name);
CREATE INDEX idx_assessments_status ON assessments(status);
CREATE INDEX idx_drugs_name ON drugs(name);
CREATE INDEX idx_drugs_category ON drugs(category);
CREATE UNIQUE INDEX idx_drugs_name_unique ON drugs(name);
```

---

## ğŸ” å®‰å…¨æ¶æ„

### å®‰å…¨å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åº”ç”¨å±‚å®‰å…¨                          â”‚
â”‚  - è¾“å…¥éªŒè¯ (Zod Schema)                           â”‚
â”‚  - XSS é˜²æŠ¤                                        â”‚
â”‚  - CSRF é˜²æŠ¤                                       â”‚
â”‚  - æ–‡ä»¶ä¸Šä¼ é™åˆ¶                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¼ è¾“å±‚å®‰å…¨                          â”‚
â”‚  - HTTPS/TLS åŠ å¯†                                  â”‚
â”‚  - CORS é…ç½®                                       â”‚
â”‚  - WebSocket Secure (WSS)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚å®‰å…¨                          â”‚
â”‚  - å¯†ç åŠ å¯†å­˜å‚¨                                     â”‚
â”‚  - æ•æ„Ÿæ•°æ®åŠ å¯†                                     â”‚
â”‚  - SQL æ³¨å…¥é˜²æŠ¤ (ORM)                               â”‚
â”‚  - å®šæœŸå¤‡ä»½                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å®‰å…¨                         â”‚
â”‚  - ç¯å¢ƒå˜é‡ä¿æŠ¤                                     â”‚
â”‚  - API å¯†é’¥ç®¡ç†                                     â”‚
â”‚  - è®¿é—®æ§åˆ¶                                        â”‚
â”‚  - æ—¥å¿—å®¡è®¡                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®éªŒè¯

```typescript
// Zod éªŒè¯ç¤ºä¾‹
const patientSchema = z.object({
  name: z.string().min(1).max(100),
  age: z.number().int().min(0).max(150),
  gender: z.enum(['ç”·', 'å¥³', 'å…¶ä»–']),
  asaClass: z.enum(['I', 'II', 'III', 'IV', 'V', 'VI']),
  medicalHistory: z.array(z.string()),
  medications: z.array(z.string()),
  allergies: z.array(z.string())
});

// ä½¿ç”¨éªŒè¯
app.post('/api/patients', async (req, res) => {
  try {
    const validatedData = patientSchema.parse(req.body);
    // å¤„ç†éªŒè¯åçš„æ•°æ®
  } catch (error) {
    res.status(400).json({ error: 'è¾“å…¥æ•°æ®æ— æ•ˆ' });
  }
});
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

```typescript
// 1. ä»£ç åˆ†å‰²
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Patients = lazy(() => import('./pages/Patients'));

// 2. æ•°æ®ç¼“å­˜
const { data: patients } = useQuery({
  queryKey: ['patients'],
  queryFn: fetchPatients,
  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
  cacheTime: 10 * 60 * 1000  // 10åˆ†é’Ÿ
});

// 3. è™šæ‹Ÿæ»šåŠ¨
<VirtualList
  items={largeDataset}
  itemHeight={50}
  windowHeight={600}
/>
```

### åç«¯ä¼˜åŒ–

```typescript
// 1. æ•°æ®åº“è¿æ¥æ± 
const pool = new Pool({
  max: 20,
  idleTimeoutMillis: 30000
});

// 2. æŸ¥è¯¢ä¼˜åŒ–
// ä½¿ç”¨ç´¢å¼•ã€é¿å… N+1 æŸ¥è¯¢
const patientsWithAssessments = await db
  .select()
  .from(patients)
  .leftJoin(assessments, eq(patients.id, assessments.patientId));

// 3. å“åº”å‹ç¼©
app.use(compression());

// 4. ç¼“å­˜ç­–ç•¥
const cache = new Map();
app.get('/api/drugs', async (req, res) => {
  const cacheKey = 'all_drugs';
  if (cache.has(cacheKey)) {
    return res.json(cache.get(cacheKey));
  }
  
  const drugs = await fetchDrugs();
  cache.set(cacheKey, drugs);
  res.json(drugs);
});
```

---

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### å¾®æœåŠ¡åŒ–å‡†å¤‡

```
å½“å‰å•ä½“æ¶æ„ â†’ æœªæ¥å¾®æœåŠ¡æ¶æ„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Monolithic App â”‚ â”€â”€â†’ â”‚  API Gateway    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Patient   â”‚   â”‚ AI Agent  â”‚   â”‚ Drug      â”‚
        â”‚ Service   â”‚   â”‚ Service   â”‚   â”‚ Service   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’ä»¶åŒ–æ¶æ„

```typescript
// ä»£ç†æ’ä»¶æ¥å£
interface AgentPlugin {
  name: string;
  version: string;
  execute(input: any): Promise<any>;
  validate(input: any): boolean;
}

// åŠ¨æ€åŠ è½½ä»£ç†
class AgentRegistry {
  private plugins: Map<string, AgentPlugin> = new Map();
  
  register(plugin: AgentPlugin) {
    this.plugins.set(plugin.name, plugin);
  }
  
  execute(name: string, input: any) {
    const plugin = this.plugins.get(name);
    return plugin?.execute(input);
  }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£](./API.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [ç³»ç»ŸåŠŸèƒ½](../SYSTEM_FEATURES.md)

---

**æ¶æ„ç‰ˆæœ¬: v2.1.0**
**æœ€åæ›´æ–°: 2025-07-11**




